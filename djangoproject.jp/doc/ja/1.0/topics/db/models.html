<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>モデルの作成 &mdash; Django v1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../',
          VERSION:     '1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="../../contents.html" />
    <link rel="index" title="Global index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Django v1.0 documentation" href="../../index.html" />
    <link rel="up" title="モデルとデータベース" href="index.html" />
    <link rel="next" title="クエリを生成する" href="queries.html" />
    <link rel="prev" title="モデルとデータベース" href="index.html" />
  </head>
  <body>
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django v1.0 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">ホーム</a>  |
        <a title="Table of contents" href="../../contents.html">目次</a>  |
        <a title="Global index" href="../../genindex.html">索引</a>  |
        <a title="Search" href="../../modindex.html">モジュール一覧</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="モデルとデータベース">前へ</a> 
     |
    <a href="../index.html" title="Django を使う" accesskey="U">上へ</a>
   |
    <a href="queries.html" title="クエリを生成する">次へ</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-db-models">
            
  
  <div class="section" id="s-module-django.db.models">
<span id="s-topics-db-models"></span><h1>モデルの作成<a class="headerlink" href="#module-django.db.models" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">revision-up-to:</th><td class="field-body">8961 (1.0)</td>
</tr>
</tbody>
</table>
<p>モデルとは、サイトを構成するデータの、ただ一つかつ最終的なデータソースを指
します。モデルには、保存したいデータに不可欠なデータフィールドと、その振舞
いが収められています。一般的に、各モデルは単一のデータベーステーブルに対応
づけられています。</p>
<p>基本として、まず以下のことを知っておきましょう:</p>
<ul class="simple">
<li>各モデルは Python のクラスで、 <a title="django.db.models.Model" class="reference external" href="../../ref/models/instances.html#django.db.models.Model"><tt class="xref docutils literal"><span class="pre">django.db.models.Model</span></tt></a> のサブ
クラスです。</li>
<li>モデルの各属性値は、データベース上のあるフィールドを表現します。</li>
<li>これらの情報をもとに、 Django はデータベース API を自動生成します。
API の詳細は <a class="reference external" href="queries.html#topics-db-queries"><em>クエリを生成する</em></a> で解説します。</li>
</ul>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">このドキュメントを理解する上で、 <a class="reference external" href="http://www.djangoproject.com/documentation/models/">モデル例の公式リポジトリ</a>
が参考になるでしょう。 (Django のソース配布物中では、これらの例は
<tt class="docutils literal"><span class="pre">tests/modeltests</span></tt> ディレクトリに収められています。)</p>
</div>
<div class="section" id="s-id3">
<span id="s-quick-example"></span><h2>簡単な例<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>以下のモデル例では、 <tt class="docutils literal"><span class="pre">first_name</span></tt> および <tt class="docutils literal"><span class="pre">last_name</span></tt> というフィールドを
持った <tt class="docutils literal"><span class="pre">Person</span></tt> を定義しています:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p><tt class="docutils literal"><span class="pre">first_name</span></tt> と <tt class="docutils literal"><span class="pre">last_name</span></tt> はモデルの <em>フィールド (fields)</em> です。各
フィールドはクラス属性として定義され、各属性がデータベースのカラムに対応し
ます。</p>
<p>上の <tt class="docutils literal"><span class="pre">Person</span></tt> モデルは、以下のようなデータベーステーブルを生成します:</p>
<div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">myapp_person</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;first_name&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;last_name&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</pre></div>
<p>以下に技術的な注意点を示します:</p>
<ul class="simple">
<li>テーブルの名前、 <tt class="docutils literal"><span class="pre">myapp_person</span></tt> はモデルのメタデータから自動的に導
出したものですが、オーバライドもできます。 <a class="reference external" href="../../ref/models/options.html#table-names"><em>テーブル名</em></a> を参照
してください。</li>
<li><tt class="docutils literal"><span class="pre">id</span></tt> は自動的に追加されますが、この挙動もまたオーバライドできます。
<a class="reference internal" href="#automatic-primary-key-fields"><em>自動的な主キーフィールド</em></a> を参照してください。</li>
<li>この例の <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> SQL 文は PostgreSQL の書式で書かれています
が、 Django は <a class="reference external" href="../settings.html#topics-settings"><em>settings file</em></a> に指定されたデー
タベースバックエンド向けの SQL を使います。</li>
</ul>
</div>
<div class="section" id="s-id4">
<span id="s-using-models"></span><h2>モデルを使う<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>モデルを定義したら、そのモデルを <em>使う</em> と Django に教えます。設定ファイル
を編集して、 <tt class="docutils literal"><span class="pre">models.py</span></tt> の入ったモジュールの名前を
<a class="reference external" href="../../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> 設定に追加してください。</p>
<p>例えば、アプリケーションのモデルが <tt class="docutils literal"><span class="pre">mysite.myapp.models</span></tt> モジュール
( <tt class="xref docutils literal"><span class="pre">manage.py</span> <span class="pre">startapp</span></tt> スクリプトで作成した、アプリケー
ションのパッケージ構造) に収められている場合、 <a class="reference external" href="../../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> は
以下のようになります:</p>
<div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c">#...</span>
    <span class="s">&#39;mysite.myapp&#39;</span><span class="p">,</span>
    <span class="c">#...</span>
<span class="p">)</span>
</pre></div>
<p>新しいアプリケーションを <a class="reference external" href="../../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> に追加したら、
<tt class="xref docutils literal"><span class="pre">manage.py</span> <span class="pre">syncdb</span></tt> を忘れずに実行してください。</p>
</div>
<div class="section" id="s-id5">
<span id="s-fields"></span><h2>フィールド<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>モデルで最も重要であり、かつモデル定義で最小限必要な部分は、モデル内が定義
しているデータベースフィールドのリストです。フィールドはクラスの属性として
定義されています。</p>
<p>例を示します:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Musician</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">instrument</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Album</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Musician</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">release_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">num_stars</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
<div class="section" id="s-id6">
<span id="s-field-types"></span><h3>フィールドのタイプ<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>モデルの各フィールドは適切な <tt class="xref docutils literal"><span class="pre">Field</span></tt> クラスのイン
スタンスにせねばなりません。 Django はフィールドクラス型を以下のいくつかの
判定に使います:</p>
<ul class="simple">
<li>データベースのカラム型 (<tt class="docutils literal"><span class="pre">INTEGER</span></tt>, <tt class="docutils literal"><span class="pre">VARCHAR</span></tt> など)。</li>
<li>Django の admin サイトで使うウィジェットの選択
(<tt class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;text&quot;&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;select&gt;</span></tt> など)。</li>
<li>Django の admin やマニピュレータで使われている最小限のバリデーション
(validation)。</li>
</ul>
<p>Django にはたくさんの組み込みフィールド型が付属しています。全フィールドのリ
ストは <a class="reference external" href="../../ref/models/fields.html#model-field-types"><em>モデルフィールドリファレンス</em></a> を参照してく
ださい。組み込みのフィールドで実現できないことがあれば、独自にフィールドを
定義できます <a class="reference external" href="../../howto/custom-model-fields.html#howto-custom-model-fields"><em>カスタムのモデルフィールド</em></a> を参照してください。</p>
</div>
<div class="section" id="s-id7">
<h3>フィールドのオプション<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>各フィールドには、それぞれフィールド固有の引数がいくつかあります(詳しくは
<a class="reference external" href="../../ref/models/fields.html#model-field-types"><em>モデルフィールドリファレンス</em></a> を参照してください)。
例えば、 <a title="django.db.models.CharField" class="reference external" href="../../ref/models/fields.html#django.db.models.CharField"><tt class="xref docutils literal"><span class="pre">CharField</span></tt></a> (とそのサブクラス) は、データ
を保存するときの <tt class="docutils literal"><span class="pre">VARCHAR</span></tt> データベースフィールドの長さを指定するために、
必須の引数 <a title="django.db.models.CharField.max_length" class="reference external" href="../../ref/models/fields.html#django.db.models.CharField.max_length"><tt class="xref docutils literal"><span class="pre">max_length</span></tt></a> が必要です。</p>
<p>また、全てのフィールドに共通の引数もあります。共通の引数は全てオプションで、
詳しくは <a class="reference external" href="../../ref/models/fields.html#common-model-field-options"><em>リファレンス</em></a> で説明しています。
ここでは、良く使われる引数を簡単に紹介しましょう:</p>
<dl class="docutils">
<dt><tt class="xref docutils literal"><span class="pre">null</span></tt></dt>
<dd><tt class="xref docutils literal"><span class="pre">True</span></tt> にすると、 Django は空の値を <tt class="docutils literal"><span class="pre">NULL</span></tt> としてデータベースに
入れます。デフォルト値は <tt class="xref docutils literal"><span class="pre">False</span></tt> です。</dd>
<dt><tt class="xref docutils literal"><span class="pre">blank</span></tt></dt>
<dd><p class="first"><tt class="xref docutils literal"><span class="pre">True</span></tt> にすると、フィールドの値を空白 (blank) にできます。デフォ
ルト値は <tt class="xref docutils literal"><span class="pre">False</span></tt> です。</p>
<p class="last"><tt class="xref docutils literal"><span class="pre">null</span></tt> とは違うことに注意してください。
<tt class="xref docutils literal"><span class="pre">null</span></tt> が純粋にデータベース上の表現に関わる概念である
のに対し、 <tt class="xref docutils literal"><span class="pre">blank</span></tt> とは値の検証 (validation) に関わ
る概念です。あるフィールドに <tt class="xref docutils literal"><span class="pre">blank=True</span></tt> を指
定すると、 Djangoの adminサイト上で、空の値のエントリを作れるように
なります。 <tt class="xref docutils literal"><span class="pre">blank=False</span></tt> にすると、そのフィール
ドには必ず値を入れねばなりません。</p>
</dd>
<dt><tt class="xref docutils literal"><span class="pre">choices</span></tt></dt>
<dd><p class="first">2 要素のタプルからなる iterable (リストまたはタプル) を、フィールド
の値の選択肢にします。この値を指定すると、 Django の admin には標準
的なテキストフィールドの代わりに選択ボックスが表示され、指定された
選択肢だけをえらべるようになります。</p>
<p>選択肢リストは以下のようになります:</p>
<div class="highlight"><pre><span class="n">YEAR_IN_SCHOOL_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&#39;FR&#39;</span><span class="p">,</span> <span class="s">&#39;Freshman&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;SO&#39;</span><span class="p">,</span> <span class="s">&#39;Sophomore&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;JR&#39;</span><span class="p">,</span> <span class="s">&#39;Junior&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;SR&#39;</span><span class="p">,</span> <span class="s">&#39;Senior&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;GR&#39;</span><span class="p">,</span> <span class="s">&#39;Graduate&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</dd>
<dt><tt class="xref docutils literal"><span class="pre">default</span></tt></dt>
<dd>フィールドのデフォルト値です。この値は、何らかの値でも、呼び出し可
能オブジェクトでもかまいません。呼び出し可能オブジェクトの場合、新
たなオブジェクトが生成されるたびに呼び出されます。</dd>
<dt><tt class="xref docutils literal"><span class="pre">help_text</span></tt></dt>
<dd>オブジェクトの admin フォームの下に表示される、追加の「ヘルプ」テキ
ストです。オブジェクトが admin のフォームを持っていなくても、ドキュ
メントとして有用でしょう。</dd>
<dt><tt class="xref docutils literal"><span class="pre">primary_key</span></tt></dt>
<dd><p class="first"><tt class="xref docutils literal"><span class="pre">True</span></tt> を指定すると、フィールドをモデルの主キーにします。</p>
<p class="last">モデルのどのフィールドにも <tt class="xref docutils literal"><span class="pre">primary_key=True</span></tt> を指定しなければ、Django は自動的に
<a title="django.db.models.IntegerField" class="reference external" href="../../ref/models/fields.html#django.db.models.IntegerField"><tt class="xref docutils literal"><span class="pre">IntegerField</span></tt></a> を追加して主キーを保存します。従って、デフォ
ルトの主キーの振舞いを変更したいのでないかぎり、
<tt class="xref docutils literal"><span class="pre">primary_key=True</span></tt> をフィールドに指定して
おく必要はありません。詳しくは
<a class="reference internal" href="#automatic-primary-key-fields"><em>自動的な主キーフィールド</em></a> を参照してください。</p>
</dd>
<dt><tt class="xref docutils literal"><span class="pre">unique</span></tt></dt>
<dd><tt class="xref docutils literal"><span class="pre">True</span></tt> であれば、フィールドはテーブル全体で一意の値を取らねばなり
ません。</dd>
</dl>
<p>前にも述べたように、ここではよく使われるフィールドオプションを簡単に説明す
るにとどめます。全てのオプションの詳細な情報は
<a class="reference external" href="../../ref/models/fields.html#common-model-field-options"><em>共通のモデルフィールドオプションのリファレンス</em></a> を参照してください。</p>
</div>
<div class="section" id="s-id9">
<span id="s-id8"></span><span id="s-automatic-primary-key-fields"></span><h3>自動的な主キーフィールド<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>デフォルトでは、 Django は各モデルに以下のフィールド:</p>
<div class="highlight"><pre><span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
<p>を追加します。これは自動的に値をインクリメントして追加してゆくフィールドで、
主キーに使われます。</p>
<p>カスタムの主キーを指定したければ、いずれかのフィールドに
<tt class="xref docutils literal"><span class="pre">primary_key=True</span></tt> を指定してください。
<tt class="xref docutils literal"><span class="pre">Field.primary_key</span></tt> の設定を見つけると、Django は <tt class="docutils literal"><span class="pre">id</span></tt> カラムを自動
的に追加しません。</p>
<p>各モデルには必ず一つ <tt class="xref docutils literal"><span class="pre">primary_key=True</span></tt> のフィー
ルドが必要です。</p>
</div>
<div class="section" id="s-id10">
<span id="s-verbose-field-names"></span><h3>詳細なフィールド名<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>各フィールドの型は、  <tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt>,
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> および
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を除き、オプションの固定引
数 (positional argument) を第一引数として指定できます。この引数には人間可読
なカラム名を指定します。引数を指定しなければ、 Django はカラム名のアンダー
スコアをスペースに変換して、自動的に人間可読なカラム名を生成します。</p>
<p>下の例では、人間可読なカラム名は <tt class="docutils literal"><span class="pre">&quot;Person's</span> <span class="pre">first</span> <span class="pre">name&quot;</span></tt> です:</p>
<div class="highlight"><pre><span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s">&quot;Person&#39;s first name&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p>下の例では <tt class="docutils literal"><span class="pre">&quot;first</span> <span class="pre">name&quot;</span></tt> です:</p>
<div class="highlight"><pre><span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
<p><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt>,
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> および
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> では、第一引数は必須で、モ
デルのクラスにします。従って、人間可読なカラム名を指定するには、
<tt class="xref docutils literal"><span class="pre">verbose_name</span></tt> キーワード引数を使います:</p>
<div class="highlight"><pre><span class="n">poll</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&quot;the related poll&quot;</span><span class="p">)</span>
<span class="n">sites</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Site</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&quot;list of sites&quot;</span><span class="p">)</span>
<span class="n">place</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">Place</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">&quot;related place&quot;</span><span class="p">)</span>
</pre></div>
<p>慣習的に、 <tt class="xref docutils literal"><span class="pre">verbose_name</span></tt> の先頭の文字は大文字にしません。
Django は必要なときに先頭の文字を自動的に大文字にします。</p>
</div>
<div class="section" id="s-id11">
<span id="s-relationships"></span><h3>リレーション<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>関係データベースの威力はテーブルを相互に関連づけることにあるのはいうまでも
ありません。Django ではよく使われるデータベースリレーション (relationship)、
多対一 (many-to-one)、多対多 (many-to-many)、一対一 (one-to-one) を定義する
方法を提供しています。</p>
<div class="section" id="s-id12">
<span id="s-many-to-one-relationships"></span><h4>多対一のリレーション<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>多対一のリレーションを定義するには
<tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt> を使います。このフィールドは他
のフィールド型と同じように、モデルのクラス属性に含めて使えます。</p>
<p><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt> には、固定引数が一つあり、リレー
ションを張る対象のクラスを指定します。</p>
<p>例えば、 <tt class="docutils literal"><span class="pre">Car</span></tt> モデルに <tt class="docutils literal"><span class="pre">Manufacturer</span></tt> というフィールドを持たせたいとし
ましょう。すなわち、ある <tt class="docutils literal"><span class="pre">Manufacturer</span></tt> には複数の <tt class="docutils literal"><span class="pre">Car</span></tt> が対応するが、
各 <tt class="docutils literal"><span class="pre">Car</span></tt> には一つだけ <tt class="docutils literal"><span class="pre">Manufacturer</span></tt> が対応するようにしたいとしましょう。
この場合、以下のように定義します:</p>
<pre>class Manufacturer(models.Model):
    # ...

class Car(models.Model):
    manufacturer = models.ForeignKey(Manufacturer)
    # ...</pre>
<p><a class="reference external" href="../../ref/models/fields.html#recursive-relationships"><em>再帰的リレーション</em></a> (自分自身に対する多対多
のリレーション) や、 <a class="reference external" href="../../ref/models/fields.html#lazy-relationships"><em>未定義のモデルに対するリレーション</em></a> も定義できます。 <a class="reference external" href="../../ref/models/fields.html#ref-foreignkey"><em>モデルフィールドのリファレンス</em></a> を参照してください。</p>
<p>必須ではありませんが、 <a title="django.db.models.ForeignKey" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey"><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt></a> の名前
(上の例では <tt class="docutils literal"><span class="pre">manufacturer</span></tt>) には、モデル名を小文字にしたものを使うよう勧
めます。もちろん好きな名前を付けてもかまいません。例えば:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">company_that_makes_it</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Manufacturer</span><span class="p">)</span>
    <span class="c"># ...</span>
</pre></div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">詳しい例は <a class="reference external" href="http://www.djangoproject.com/documentation/models/many_to_one/">多対一のリレーションを持つモデルの例</a> を参照してください。</p>
</div>
<p><a title="django.db.models.ForeignKey" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey"><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt></a> フィールドは、リレーションの動作を定
義するための引数をいくつかとれます。各引数は
<a class="reference external" href="../../ref/models/fields.html#foreign-key-arguments"><em>モデルフィールドのリファレンス</em></a> で解説してい
ます。そうした引数を使うと、リレーションのふるまいを定義する上で役に立ちま
す。引数は全てオプションです。</p>
</div>
<div class="section" id="s-id14">
<span id="s-many-to-many-relationships"></span><h4>多対多のリレーション<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>多対多の (many-to-many) リレーションを定義するには
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> を使います。このフィール
ドは他のフィールド型と同じように、モデルのクラス属性に含めて使えます。</p>
<p><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> には固定引数が一つあり、
リレーションを張る対象のクラスを指定します。</p>
<p>例えば、 <tt class="docutils literal"><span class="pre">Pizza</span></tt> には複数の <tt class="docutils literal"><span class="pre">Topping</span></tt> オブジェクトを持たせられます。
すなわち、ある <tt class="docutils literal"><span class="pre">Topping</span></tt> は複数のピザの上に置けて、逆にそれぞれのピザには
複数のトッピングを置けるというわけです。このリレーションを表すには次のように
します:</p>
<pre>class Topping(models.Model):
    # ...

class Pizza(models.Model):
    # ...
    toppings = models.ManyToManyField(Topping)</pre>
<p><a title="django.db.models.ForeignKey" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey"><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt></a> と同様、 <a class="reference external" href="../../ref/models/fields.html#recursive-relationships"><em>再帰的リレーション</em></a> (自分自身に対する多対一のリレーション) や、
<a class="reference external" href="../../ref/models/fields.html#lazy-relationships"><em>未定義のモデルに対するリレーション</em></a> も定義できま
す。 <a class="reference external" href="../../ref/models/fields.html#ref-foreignkey"><em>モデルフィールドのリファレンス</em></a> を参照してくだ
さい。</p>
<p>必須ではありませんが、 <tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> の
名前 (上の例では <tt class="docutils literal"><span class="pre">toppings</span></tt>)は、リレーション先のモデル名の複数形にするよ
う勧めます。</p>
<p>どちらのモデルで <tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> を定義し
てもかまいませんが、どちらか片方のモデルにしか必要ありません -- 両方には指
定できません。</p>
<p>一般的に、 Django の admin を使っている場合、
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> インスタンスを入れておく
のは、 admin インタフェースで編集される側のオブジェクトにしておきます。上の
例では、 <tt class="docutils literal"><span class="pre">topping</span></tt> は (<tt class="docutils literal"><span class="pre">Topping</span></tt> に
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> の <tt class="docutils literal"><span class="pre">pizzas</span></tt> をもたせる
のではなく) <tt class="docutils literal"><span class="pre">Pizza</span></tt> に入れておきます。というのも、「トッピングを乗せるピ
ザ」と考えるよりも「ピザの上に乗せるトッピング」を考える方が自然だからです。
こうして上の例では、 <tt class="docutils literal"><span class="pre">Pizza</span></tt> の admin フォームでユーザにトッピングを選ば
せることになります。</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">完全な例は <a class="reference external" href="http://www.djangoproject.com/documentation/models/many_to_many/">多対多のリレーションを持つモデルの例</a> を参照してください。</p>
</div>
<p><a title="django.db.models.ManyToManyField" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyField"><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt></a> フィールドは、リレーションの動作
を定義するための引数をいくつかとれます。各引数は <a class="reference external" href="../../ref/models/fields.html#foreign-key-arguments"><em>モデルフィールドのリ
ファレンス</em></a> で解説しています。引数は全てオプション
です。</p>
</div>
<div class="section" id="s-id16">
<h4>多対多を定義するためのエクストラフィールド<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="versionadded">
<span class="title">Django 1.0 で新たに登場しました.</span> </div>
<p>ピザとトッピングを組み合わせたり照合したりするだけのような多対多のリレーショ
ンを扱いたいのなら、標準の <a title="django.db.models.ManyToManyField" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyField"><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt></a> で事
足ります。しかし、時として、二つのモデルのリレーションそのものにデータを関
連づけたい場合があります。</p>
<p>例えば、ミュージシャンのグループと、在籍しているミュージシャンを追跡するア
プリケーションのケースを考えてみましょう。これは個人 (person) とグループの
関係なので、 <a title="django.db.models.ManyToManyField" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyField"><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt></a> でリレーションを表
現できるはずです。しかし、ミュージシャンとグループの関係には、あるミュージ
シャンがあるグループにいつ合流したか、のような細かい情報がたくさんあります。</p>
<p>こうした状況を解決するために、 Django では、多対多のリレーションを定義する
ときに、あらかじめリレーションを管理するためのモデル(中間モデル)を定義して
おき、その中間モデルに向けてエクストラフィールド (extra field) を組み込めま
す。中間モデルは <a title="django.db.models.ManyToManyField" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyField"><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt></a> の
<tt class="xref docutils literal"><span class="pre">through</span></tt> 引数に指定します。ミュージシャン
の例では、コードは以下のように表されます:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">members</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">through</span><span class="o">=</span><span class="s">&#39;Membership&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Membership</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span>
    <span class="n">date_joined</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">invite_reason</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</pre></div>
<p>中間モデルでは、多対多のリレーションの両側にあたるモデルに対して明示的に外
部キーを張らねばなりません。この明示的な定義によってはじめて、モデルのリレー
ションが宣言されます:</p>
<p>中間モデルには、いくつか制約があります:</p>
<ul class="simple">
<li>中間モデルは、多対多リレーションのターゲットモデル (リレーションを張
られる側のモデル) に対する外部キーを <em>一つだけ</em> しか定義できません
(上の例では <tt class="docutils literal"><span class="pre">Person</span></tt> ですね)。同じモデルに複数の外部キーを定義する
と、モデルのバリデーション時にエラーを送出します。</li>
<li>中間モデルは、多対多リレーションのソースモデル (リレーションを張る側
のモデル) に対する外部キーを <em>一つだけ</em> しか定義できません (上の例で
は <tt class="docutils literal"><span class="pre">Group</span></tt> ですね)。同じモデルに複数の外部キーを定義すると、モデル
のバリデーション時にエラーを送出します。</li>
<li>自分自身に対する多対多のリレーションを定義するのに中間モデルを使う場
合にのみ、例外的に同じモデルに対するリレーションを二つ定義できます。
ただし、多対多リレーションの中では、二つの外部キーは別々、すなわちソー
スとターゲットを区別して扱います。</li>
<li>中間モデルを使って、あるモデルから自分自身に多対対のリレーションを定
義する場合、 <a title="django.db.models.ManyToManyFields.symmetrical" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyFields.symmetrical"><tt class="xref docutils literal"><span class="pre">symmetrical=False</span></tt></a>
を指定せねばなりません ( <a class="reference external" href="../../ref/models/fields.html#manytomany-arguments"><em>モデルフィールドのリファレンス</em></a> を参照してください) 。</li>
</ul>
<p>さて、これで中間モデル (例でいうところの <tt class="docutils literal"><span class="pre">Membership</span></tt>) を使った
<a title="django.db.models.ManyToManyField" class="reference external" href="../../ref/models/fields.html#django.db.models.ManyToManyField"><tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt></a> を設定したので、多対多のリレーショ
ンを生成できます。リレーションの生成は、中間モデルのインスタンス生成によっ
て実現します:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ringo</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ringo Starr&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paul</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Paul McCartney&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beatles</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;The Beatles&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span> <span class="o">=</span> <span class="n">Membership</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">ringo</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">beatles</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">date_joined</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1962</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">invite_reason</span><span class="o">=</span> <span class="s">&quot;Needed a new drummer.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beatles</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Person: Ringo Starr&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ringo</span><span class="o">.</span><span class="n">group_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Group: The Beatles&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">Membership</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">person</span><span class="o">=</span><span class="n">paul</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">beatles</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">date_joined</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">invite_reason</span><span class="o">=</span> <span class="s">&quot;Wanted to form a band.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beatles</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Person: Ringo Starr&gt;, &lt;Person: Paul McCartney&gt;]</span>
</pre></div>
<p>通常の <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt> と違い、 <tt class="docutils literal"><span class="pre">add</span></tt> や <tt class="docutils literal"><span class="pre">create</span></tt>,
(<tt class="docutils literal"><span class="pre">beatles.members</span> <span class="pre">=</span> <span class="pre">[...]</span></tt> のような) 代入によるリレーションの定義
は行えません:</p>
<pre># THIS WILL NOT WORK
&gt;&gt;&gt; beatles.members.add(john)
# NEITHER WILL THIS
&gt;&gt;&gt; beatles.members.create(name="George Harrison")
# AND NEITHER WILL THIS
&gt;&gt;&gt; beatles.members = [john, paul, ringo, george]</pre>
<p>なぜでしょうか。中間モデルでリレーションを作成すると、単に <tt class="docutils literal"><span class="pre">Person</span></tt> と
<tt class="docutils literal"><span class="pre">Group</span></tt> の間のリレーションを生成するだけではなく、 <tt class="docutils literal"><span class="pre">Membership</span></tt> テーブ
ルに必要な全ての情報が必要です。単に <tt class="docutils literal"><span class="pre">add</span></tt> や <tt class="docutils literal"><span class="pre">create</span></tt> を呼び出したり
代入を行うだけでは、リレーション以外の情報を埋められません。その結果、中間
モデルを使う場合は、 <tt class="docutils literal"><span class="pre">add</span></tt> や <tt class="docutils literal"><span class="pre">create</span></tt> は無効化されるのです。中間モデル
を使った多対多のリレーションを定義するには、中間モデルのインスタンスを生成
するしかない、ということを覚えておいてください。</p>
<p>同じ理由で、 <tt class="docutils literal"><span class="pre">remove</span></tt> メソッドも無効化されています。ただし、 <tt class="docutils literal"><span class="pre">clear()</span></tt>
メソッドを使えば、以下のように多対多のリレーションを一括して消去できます:</p>
<pre># Beatles have broken up
&gt;&gt;&gt; beatles.members.clear()</pre>
<p>中間のモデルを使って多対多のリレーションを確立したら、リレーションをまたい
だクエリを実行できます。通常の多対多リレーションと同じく、リレーション先の
モデルの属性を使ってクエリを実行します:</p>
<pre># 'Paul' で始まる名前の人がメンバにいるグループを探す
&gt;&gt;&gt; Groups.objects.filter(person__name__startswith='Paul')
[&lt;Group: The Beatles&gt;]</pre>
<p>中間テーブルを使っているので、中間のモデルの属性を使ったクエリも実行できま
す:</p>
<pre># 1961年1月1日以降に合流した Beatles のメンバを探す
&gt;&gt;&gt; Person.objects.filter(
...     group__name='The Beatles',
...     membership__date_joined__gt=date(1961,1,1))
[&lt;Person: Ringo Starr]</pre>
</div>
<div class="section" id="s-id17">
<span id="s-one-to-one-relationships"></span><h4>一対一のリレーション<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>一対一のリレーションを定義するには、
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を使います。このフィールド
は他のフィールド型と同じように、モデルのクラス属性に含めて使えます。</p>
<p>このリレーションがもっとも有用なのは、あるオブジェクトが別のオブジェクトを
何らかの形で「拡張」している場合の主キーとして使う場合です。</p>
<p><tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> には固定引数が一つあり、リ
レーションを張る対象のクラスを指定します。</p>
<p>例えば、「場所 (place)」のデータベースを作るときには、アドレス、電話番号、
といった標準的なものを作成します。その上で、レストランデータベースを作成
するときに、 <tt class="docutils literal"><span class="pre">Restaurant</span></tt> モデルの中に同じフィールドをつくるような
繰り返し作業 (repeat yourself) をする代わりに、場所データベースを基盤にして
レストランのデータベースを作成したいとしましょう。このとき、 <tt class="docutils literal"><span class="pre">Restaurant</span></tt>
には <tt class="docutils literal"><span class="pre">Place</span></tt> への <tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> をもた
せられます (レストランは場所に対して &quot;is-a&quot; の関係だからです。実際には、こ
のような状況を扱うのに <a class="reference internal" href="#model-inheritance"><em>モデルの継承</em></a> を使いますが、
モデル継承は <tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> で実現されてい
ます)。</p>
<p><a title="django.db.models.ForeignKey" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey"><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt></a> と同様、
<a class="reference external" href="../../ref/models/fields.html#recursive-relationships"><em>再帰的リレーション</em></a> や
<a class="reference external" href="../../ref/models/fields.html#lazy-relationships"><em>未定義のモデルに対するリレーション</em></a> も定義できま
す。詳しくは <tt class="xref docutils literal"><span class="pre">モデルフィールドのリファレンス</span></tt> を参照してください。</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">詳細な例は <a class="reference external" href="http://www.djangoproject.com/documentation/models/one_to_one/">一対一のリレーションを持つモデルの例</a> を参照してください。</p>
</div>
<div class="versionadded">
<span class="title">Django 1.0 で新たに登場しました.</span> </div>
<p><a title="django.db.models.OneToOneField" class="reference external" href="../../ref/models/fields.html#django.db.models.OneToOneField"><tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt></a> フィールドは、オプションの引数を一
つとります。引数は <a class="reference external" href="../../ref/models/fields.html#ref-onetoone"><em>モデルフィールドリファレンス</em></a> で解
説しています。</p>
<p>以前は、モデル中で <tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を使うと、
そのフィールドは自動的にモデルの主キーになっていました。この仕様はもうなく
なりましたが、主キーにしたければ手動で <tt class="docutils literal"><span class="pre">primary_key</span></tt> に指定できます。この
変更により、一つのモデル中で複数の
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を使えるようになりました。</p>
</div>
</div>
<div class="section" id="s-id19">
<span id="s-models-across-files"></span><h3>ファイル間にまたがるモデル<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>あるモジュールから別のモジュールへのリレーションは全く問題なく張れます。リ
レーションを張るには、モデル定義の先頭でリレーション対称のモデルを import
しておき、必要なところでそのモデルクラスを参照します。例えば:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">mysite.geography.models</span> <span class="kn">import</span> <span class="n">ZipCode</span>

<span class="k">class</span> <span class="nc">Restaurant</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">zip_code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ZipCode</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="s-id20">
<span id="s-field-name-restrictions"></span><h3>フィールド名の制約<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Django がモデルのフィールド名に課している制約は二つしかありません:</p>
<ol class="arabic">
<li><p class="first">フィールド名は Python の予約語であってはなりません。さもなければ
Python のシンタクスエラーを引き起こすからです。例えば:</p>
<pre>class Example(models.Model):
    pass = models.IntegerField() # 'pass' is a reserved word!</pre>
</li>
<li><p class="first">フィールド名には二つ以上の連続するアンダースコアを入れてはなりません。
なぜなら、Django のクエリ照合構文で使われているからです。例えば:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">foo__bar</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span> <span class="c"># &#39;foo__bar&#39; has two underscores!</span>
</pre></div>
</li>
</ol>
<p>フィールドの名前は必ずしもデータベースのカラム名と一致していなくてもよいの
で、これらの制約は回避可能です。詳しくは後述の <tt class="xref docutils literal"><span class="pre">db_column</span></tt> を
参照してください。</p>
<p><tt class="docutils literal"><span class="pre">join</span></tt> や <tt class="docutils literal"><span class="pre">where</span></tt>, <tt class="docutils literal"><span class="pre">select</span></tt> のような SQL の予約語は、モデルのフィール
ド名に使っても <em>かまいません</em> 。というのも、Django はいかなる SQL クエリ文
でも全てのデータベーステーブル名やカラム名をエスケープするからです。エスケー
プにはデータベースエンジン固有のクオートシンタクスを使います。</p>
</div>
<div class="section" id="s-id21">
<span id="s-custom-field-types"></span><h3>カスタムのフィールド型<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<span class="title">Django 1.0 で新たに登場しました.</span> </div>
<p>既存のモデルフィールドが目的とするアプリケーションに合わない場合や、あまり
一般的でないデータベースカラムタイプを活用したい場合のために、独自のフィー
ルドクラスを作成できます。独自のフィールドの作成方法の詳細は
<a class="reference external" href="../../howto/custom-model-fields.html#howto-custom-model-fields"><em>カスタムのモデルフィールド</em></a> で説明しています。</p>
</div>
</div>
<div class="section" id="s-meta">
<span id="s-id22"></span><span id="s-meta-options"></span><h2>Meta オプション<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h2>
<p>モデルにメタデータを指定するには、以下のようにモデルの内部クラス
<tt class="docutils literal"><span class="pre">Meta</span></tt> を使います:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Ox</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">horn_length</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;horn_length&quot;</span><span class="p">]</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s">&quot;oxen&quot;</span>
</pre></div>
<p>モデルのメタデータとは、モデルインスタンスの整列順
(<a title="django.db.models.Options.ordering" class="reference external" href="../../ref/models/options.html#django.db.models.Options.ordering"><tt class="xref docutils literal"><span class="pre">ordering</span></tt></a>)や、データベース上のテーブル名
(<a title="django.db.models.Options.db_table" class="reference external" href="../../ref/models/options.html#django.db.models.Options.db_table"><tt class="xref docutils literal"><span class="pre">db_table</span></tt></a>)、人間可読な名前の単数形や複数形
(<a title="django.db.models.Options.verbose_name" class="reference external" href="../../ref/models/options.html#django.db.models.Options.verbose_name"><tt class="xref docutils literal"><span class="pre">verbose_name</span></tt></a>, <a title="django.db.models.Options.verbose_name_plural" class="reference external" href="../../ref/models/options.html#django.db.models.Options.verbose_name_plural"><tt class="xref docutils literal"><span class="pre">verbose_name_plural</span></tt></a>)といっ
た、「フィールドの情報でない」情報です。必須のメタデータはなく、モデルに
<tt class="docutils literal"><span class="pre">class</span> <span class="pre">Meta</span></tt> を追加するかどうか自体オプションです。</p>
<p><tt class="docutils literal"><span class="pre">Meta</span></tt> に指定できるオプションの一覧は、 <a class="reference external" href="../../ref/models/options.html#ref-models-options"><em>モデルオプションのリファレ
ンス</em></a> で解説しています。</p>
</div>
<div class="section" id="s-id24">
<span id="s-id23"></span><span id="s-model-methods"></span><h2>モデルのメソッド<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<p>カスタムの行レベル (&quot;row-level&quot;) の機能をオブジェクトに実装するには、カスタ
ムのメソッドを定義します。 <a title="django.db.models.Manager" class="reference external" href="managers.html#django.db.models.Manager"><tt class="xref docutils literal"><span class="pre">Manager</span></tt></a> メソッドの目
的が「テーブル級 (table-wide)」 の操作であるのに対し、モデルメソッドは個々
のモデルインスタンスに対して作用します。</p>
<p>このモデルメソッドは、ビジネスロジックをモデルというただ一箇所にまとめてお
くのに有用なテクニックになります。</p>
<p>例えば、以下のモデル例にはいくつかカスタムメソッドがあります:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib.localflavor.us.models</span> <span class="kn">import</span> <span class="n">USStateField</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">USStateField</span><span class="p">()</span> <span class="c"># Yes, this is America-centric...</span>

    <span class="k">def</span> <span class="nf">baby_boomer_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the person&#39;s baby-boomer status.&quot;</span>
        <span class="kn">import</span> <span class="nn">datetime</span>
        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1945</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">&lt;=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1964</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Baby boomer&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1945</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;Pre-boomer&quot;</span>
        <span class="k">return</span> <span class="s">&quot;Post-boomer&quot;</span>

    <span class="k">def</span> <span class="nf">is_midwestern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns True if this person is from the Midwest.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;IL&#39;</span><span class="p">,</span> <span class="s">&#39;WI&#39;</span><span class="p">,</span> <span class="s">&#39;MI&#39;</span><span class="p">,</span> <span class="s">&#39;IN&#39;</span><span class="p">,</span> <span class="s">&#39;OH&#39;</span><span class="p">,</span> <span class="s">&#39;IA&#39;</span><span class="p">,</span> <span class="s">&#39;MO&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the person&#39;s full name.&quot;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_full_name</span><span class="p">)</span>
</pre></div>
<p>この例の最後のメソッドは <a class="reference external" href="../../glossary.html#term-18"><em class="xref">プロパティ</em></a> (<a class="reference external" href="../../glossary.html#term-property"><em class="xref">property</em></a>) です。詳しく
は <a class="reference external" href="http://www.python.org/download/releases/2.2/descrintro/#property">プロパティの説明</a> を参照してください。</p>
<p><a class="reference external" href="../../ref/models/instances.html#ref-models-instances"><em>モデルインスタンスのリファレンス</em></a> では、
<a class="reference external" href="../../ref/models/instances.html#model-instance-methods"><em>各モデルに自動的に付与されるメソッド</em></a> を全て
紹介しています。ほとんどのメソッドはオーバライド可能です。詳しくは後述の
<a class="reference internal" href="#id26">既存のモデルメソッドをオーバライドする</a> を参照してください。とはいえ、
ほとんどの場合は、以下の 2 つのメソッドをオーバライドするでしょう:</p>
<dl class="docutils">
<dt><a title="django.db.models.Model.__unicode__" class="reference external" href="../../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a></dt>
<dd><p class="first">オブジェクトの「Unicode 表現」を返す、Python の「マジックメソッド」
です。 Python や Django はこのメソッドを使ってモデルインスタンスに
型強制を適用し、通常の文字列に変換したり表示したりしています。特に、
対話コンソールや admin でオブジェクトを表示するときに使われています。</p>
<p class="last">このメソッドは常に定義するよう勧めます。定義しておくと、いろいろと
便利だからです。</p>
</dd>
<dt><a title="django.db.models.Model.get_absolute_url" class="reference external" href="../../ref/models/instances.html#django.db.models.Model.get_absolute_url"><tt class="xref docutils literal"><span class="pre">get_absolute_url()</span></tt></a></dt>
<dd><p class="first">このメソッドを定義しておくと、 Django にオブジェクトの URL を計算さ
せられます。 Django は admin インタフェースをはじめとして、オブジェ
クトから URL を特定する必要があるときにこのメソッドを使います。</p>
<p class="last">オブジェクトを一意に特定できるような URL を持たせたいときには、この
メソッドを定義しましょう。</p>
</dd>
</dl>
<div class="section" id="s-id26">
<span id="s-overriding-predefined-model-methods"></span><h3>既存のモデルメソッドをオーバライドする<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>他にも、データベースの動作をカプセル化していて、カスタマイズ可能な <a class="reference external" href="../../ref/models/instances.html#model-instance-methods"><em>モ
デルメソッド</em></a> があります。特によく変更するのは、
<a title="django.db.models.Model.save" class="reference external" href="../../ref/models/instances.html#django.db.models.Model.save"><tt class="xref docutils literal"><span class="pre">save()</span></tt></a> や <tt class="xref docutils literal"><span class="pre">delete()</span></tt> の動作でしょう。</p>
<p>これらのメソッド (や、他のモデルメソッド) は、モデルのふるまいを変更するた
めに自由にオーバライドしてかまいません。</p>
<p>組み込みメソッドをオーバライドする古典的なユースケースは、オブジェクトを保
存する際に何か別の処理を行うというものです。例を示しましょう
(<a title="django.db.models.Model.save" class="reference external" href="../../ref/models/instances.html#django.db.models.Model.save"><tt class="xref docutils literal"><span class="pre">save()</span></tt></a> のパラメタはドキュメントを参照してください。):</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tagline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_insert</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">do_something</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="p">,</span> <span class="n">force_insert</span><span class="p">)</span> <span class="c"># 「実際の」 save() を呼び出します。</span>
        <span class="n">do_something_else</span><span class="p">()</span>
</pre></div>
<p>また、以下のようにすれば保存を抑止できます:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tagline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_insert</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;Yoko Ono&#39;s blog&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="c"># Yoko は自分のブログを持っていません！</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="p">,</span> <span class="n">force_update</span><span class="p">)</span> <span class="c"># Call the &quot;real&quot; save() method.</span>
</pre></div>
<p>スーパクラスのメソッド呼び出し、つまり <tt class="docutils literal"><span class="pre">super(Blog,</span> <span class="pre">self).save()</span></tt> を忘れ
ないでください。この呼び出しを忘れると、デフォルトの動作が行われないため、
データベースにデータが保存されません。</p>
</div>
<div class="section" id="s-sql">
<span id="s-executing-custom-sql"></span><h3>カスタム SQL の実行<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
<p>もう一つよくあるパターンは、カスタムの SQL 文をモデルメソッドやモジュールレ
ベルのメソッドにに書くというものです。まず、現在のデータベース接続を表現す
る <tt class="xref docutils literal"><span class="pre">django.db.connection</span></tt> オブジェ
クを import します。このオブジェクトを使うには、 <tt class="xref docutils literal"><span class="pre">connection.cursor()</span></tt> を呼び出してカーソルオブジェク
トを作成し、 <tt class="docutils literal"><span class="pre">cursor.execute(sql,</span> <span class="pre">[params])</span></tt> で SQL 文を実行して、
<tt class="xref docutils literal"><span class="pre">cursor.fetchone()</span></tt> や
<tt class="xref docutils literal"><span class="pre">cursor.fetchall()</span></tt> で結
果のレコード行を取り出します。例えば:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">my_custom_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT foo FROM bar WHERE baz = </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">baz</span><span class="p">])</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">row</span>
</pre></div>
<p><tt class="xref docutils literal"><span class="pre">connection</span></tt> や
<tt class="xref docutils literal"></tt> は、 <span class="target" id="index-7"></span><a class="reference external" href="http://www.python.org/dev/peps/pep-0249"><strong>PEP 249</strong></a> で定義されてい
る標準的な Python DB-API のほぼ全てに加えて、 Django の <a class="reference external" href="transactions.html#topics-db-transactions"><em>トランザクショ
ン処理</em></a> を実装しています。 Python DB-API にあまり
詳しくないのなら、パラメタつきの SQL を実行するときに、SQL 文にパラメタを直
接指定して実行するのではなく、 <tt class="xref docutils literal"><span class="pre">cursor.execute()</span></tt> の SQL 文内でプレースホルダ
<tt class="docutils literal"><span class="pre">&quot;%s&quot;</span></tt> を使うことに注意してください。このテクニックを使えば、データベース
ライブラリの中で自動的にクオート処理が行われます。 (また、 Django の使って
いるプレースホルダ <tt class="docutils literal"><span class="pre">&quot;%s&quot;</span></tt> は、 SQLite の Python バインディングで使われて
いる <tt class="docutils literal"><span class="pre">&quot;?&quot;</span></tt> と違うということにも注意しましょう。この設計は、一貫性と安全性
に配慮して決められています。)</p>
<p>最後に、カスタムの <tt class="docutils literal"><span class="pre">WHERE</span></tt> 節を持つ SQL を実行したいだけなら、
<tt class="xref docutils literal"><span class="pre">extra()</span></tt> 照合メソッドを使えることにも注意しておきましょう。</p>
</div>
</div>
<div class="section" id="s-id27">
<span id="s-model-inheritance"></span><h2>モデルの継承<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<span class="title">Django 1.0 で新たに登場しました.</span> </div>
<p>Django のモデルクラス継承は、 Python の通常のクラス継承とほぼ同じように動作
します。モデル継承を実現するには、一つだけきめておかねばならないことがあり
ます。それは、親クラスに独自のデータベーステーブルを持たせるか、親クラスを
単なるホルダとして使い、子クラスで共通の情報を持たせるだけにするかです。</p>
<p>複数の子モデルクラスでいちいち同じ情報を入力せずに済ませるために、親モデル
クラスに共通の情報を持たせたいことはよくあります。親モデルクラスを単体で使
うことがないのなら、 <a class="reference internal" href="#abstract-base-classes"><em>抽象ベースクラス</em></a> を使うのがよいでしょう。
一方、(他のアプリケーションなどにある) 既存のモデルをサブクラス化して拡張し
たり、個々のモデルに固有のデータベースを持たせたいような場合には、
<a class="reference internal" href="#multi-table-inheritance"><em>マルチテーブル継承</em></a> を使うのがよいでしょう。</p>
<div class="section" id="s-id29">
<span id="s-id28"></span><span id="s-abstract-base-classes"></span><h3>抽象ベースクラス<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>抽象ベースクラスは、たくさんのモデルに共通する情報を入れておきたいときに便
利な仕組みです。抽象ベースクラスを定義するには、ベースクラス定義の、
<a class="reference internal" href="#meta-options"><em>Meta</em></a> に <tt class="docutils literal"><span class="pre">abstract=True</span></tt> を入れておきます。モデルを
抽象ベースクラスとして定義すると、そのクラスはデータベーステーブルを生成し
ません。その代り、他のモデルを定義するときに抽象ベースクラスを親にすると、
ベースクラスのフィールドが子クラスに追加されます。抽象ベースクラスで定義し
たフィールドと同じ名前のフィールドを子クラスで定義しようとするとエラーを引
き起こします (Django は例外を送出します)。</p>
<p>例を示しましょう:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">CommonInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">CommonInfo</span><span class="p">):</span>
    <span class="n">home_group</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
<p>このように定義すると、 <tt class="docutils literal"><span class="pre">Student</span></tt> モデルは <tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">age</span></tt> および
<tt class="docutils literal"><span class="pre">home_group</span></tt> の三つのフィールドを持つようになります。. <tt class="docutils literal"><span class="pre">CommonInfo</span></tt> モ
デルは抽象ベースクラスなので、通常の Django モデルとしては使えません。
<tt class="docutils literal"><span class="pre">CommonInfo</span></tt> はデータベーステーブルを作らず、マネジャなども持ちません。</p>
<p>ほとんどの用途で使えるのは、このタイプのモデル継承でしょう。抽象ベースクラ
スは、子クラスで共通の情報を Python レベルに切り出しながらも、データベース
レベルでは、各子クラスに一つのデータベーステーブルを生成します。</p>
<div class="section" id="s-id30">
<span id="s-meta-inheritance"></span><h4><tt class="docutils literal"><span class="pre">Meta</span></tt> の継承<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>抽象ベースクラスを作成するとき、 Django は抽象ベースクラスの内部クラス
<a class="reference internal" href="#meta-options"><em>Meta</em></a> をクラス属性として参照できるようにします。子クラ
スで <a class="reference internal" href="#meta-options"><em>Meta</em></a> クラスを定義しない場合、親クラスの
<a class="reference internal" href="#meta-options"><em>Meta</em></a> がそのまま継承されます。子クラスで
<a class="reference internal" href="#meta-options"><em>Meta</em></a> を拡張したければ、親クラスをサブクラス化できます。
以下に例を示しましょう:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">CommonInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">CommonInfo</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonInfo</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;student_info&#39;</span>
</pre></div>
<p>Django は抽象ベースクラスの <a class="reference internal" href="#meta-options"><em>Meta</em></a> クラスを生成するとき
に一つだけ手を加えます。すなわち、 <a class="reference internal" href="#meta-options"><em>Meta</em></a> の属性を組み
込む前に、 <tt class="docutils literal"><span class="pre">abstract=False</span></tt> を設定するのです。これにより、抽象ベースクラ
スの子クラスが自動的に非抽象ベースクラスになります。もちろん、他の抽象ベー
スクラスを継承した新たな抽象ベースクラスも定義できます。継承するには、明示
的に <tt class="docutils literal"><span class="pre">abstract=True</span></tt> をセットしてください。</p>
<p><a class="reference internal" href="#meta-options"><em>Meta</em></a> クラスの属性の中には、抽象ベースクラスで定義して
も意味のないものもあります。例えば、 <tt class="docutils literal"><span class="pre">db_table</span></tt> を抽象ベースクラスの
<a class="reference internal" href="#meta-options"><em>Meta</em></a> で定義すると、その子クラス全て (で、独自に
<a class="reference internal" href="#meta-options"><em>Meta</em></a> を定義しないもの) が、同じデータベーステーブルを
使おうとしてしまいます。</p>
</div>
<div class="section" id="s-related-name">
<span id="s-be-careful-with-related-name"></span><span id="s-abstract-related-name"></span><h4><tt class="docutils literal"><span class="pre">related_name</span></tt> に注意<a class="headerlink" href="#related-name" title="Permalink to this headline">¶</a></h4>
<p><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt> や
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> に <tt class="docutils literal"><span class="pre">related_name</span></tt> 属性
を使っている場合には、フィールドの <em>一意な</em> 逆リレーション名を指定してくだ
さい。抽象ベースクラスのフィールドは
(<a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> の設定値を含み) 子クラス
にそのまま組み込まれるので、 子クラスで同じ
<a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> のフィールドができてしま
うため、問題を引き起こします。</p>
<p>この問題を回避するには、抽象ベースクラスで
<a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> を使うときに(かつその時に
限り)、文字列の一部に <tt class="docutils literal"><span class="pre">'%(class)s'</span></tt> を付加してください。そうすると、
<tt class="docutils literal"><span class="pre">'%(class)s'</span></tt> は子クラスでクラスの小文字名に置き換えられます。各クラスは
個別の名前をもっているので、結果的にリレーション名は個別の名前に
なります。例えば:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">m2m</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToMany</span><span class="p">(</span><span class="n">OtherModel</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(class)s</span><span class="s">_related&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">ChildA</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ChildB</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
<p>この例で、 <tt class="docutils literal"><span class="pre">ChildA.m2m</span></tt> フィールドの逆リレーション名は <tt class="docutils literal"><span class="pre">childa_related</span></tt>
になり、 <tt class="docutils literal"><span class="pre">ChildB.m2m</span></tt> フィールドの逆リレーション名は <tt class="docutils literal"><span class="pre">childb_related</span></tt>
になります。逆リレーション名の定義で <tt class="docutils literal"><span class="pre">'%(class)s'</span></tt> をどう使うかはユーザ次
第ですが、 <tt class="docutils literal"><span class="pre">'%(class)s'</span></tt> を使いわすれると、モデルの検証時 (または
<tt class="xref docutils literal"><span class="pre">syncdb</span></tt> 時) に例外を送出します。</p>
<p>抽象ベースクラスのフィールドに
<a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a>
属性を指定しない場合、子クラスの名前に <tt class="docutils literal"><span class="pre">'_set'</span></tt> をつけた名前をデフォルト
の逆リレーション名として使います。これは子クラスで直接リレーションフィール
ドを定義した場合と同じ挙動です。例えば、上のコードで
<a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> 属性を省略すると、
<tt class="docutils literal"><span class="pre">m2m</span></tt> フィールドの逆リレーション名は <tt class="docutils literal"><span class="pre">ChildA</span></tt> では <tt class="docutils literal"><span class="pre">childa_set</span></tt> 、
<tt class="docutils literal"><span class="pre">ChildB</span></tt> では <tt class="docutils literal"><span class="pre">childb_set</span></tt> です。</p>
</div>
</div>
<div class="section" id="s-id32">
<span id="s-id31"></span><span id="s-multi-table-inheritance"></span><h3>マルチテーブル継承<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>Django では、継承の各階層にいるクラスが抽象クラスでない実際のモデルであるよ
うな、もう一つのタイプのモデル継承をサポートしています。各モデルはそれぞれ
が一個のデータベーステーブルを表現していて、個別にクエリを発行したり、イン
スタンスを生成したりできます。継承の関係によって、親クラスと子クラスの間に
は (自動生成された <tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> によって)
リンクが張られます。以下の例で説明しましょう:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Place</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Restaurant</span><span class="p">(</span><span class="n">Place</span><span class="p">):</span>
    <span class="n">serves_hot_dogs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">serves_pizza</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
</pre></div>
<p><tt class="docutils literal"><span class="pre">Place</span></tt> の全てのフィールドは、 <tt class="docutils literal"><span class="pre">Restaurant</span></tt> からも使えます。しかし、そ
れぞれのフィールドのデータは別々のテーブルに格納されます。従って、以下のよ
うな操作をどちらも実行できます:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&#39;s Cafe&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&#39;s Cafe&quot;</span><span class="p">)</span>
</pre></div>
<p>例えば、 <tt class="docutils literal"><span class="pre">Place</span></tt> であり、かつ <tt class="docutils literal"><span class="pre">Restaurant</span></tt> でもあるようなオブジェクトが
あれば、モデル名を小文字にした属性を使って、 <tt class="docutils literal"><span class="pre">Place</span></tt> から <tt class="docutils literal"><span class="pre">Restaurant</span></tt>
を取り出せます:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&#39;s Cafe&quot;</span><span class="p">)</span>
<span class="go"># Bob&#39;s Cafe が Restaurant オブジェクトなら、子クラスを返す:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">restaurant</span>
<span class="go">&lt;Restaurant: ...&gt;</span>
</pre></div>
<p>ただし、上の <tt class="docutils literal"><span class="pre">p</span></tt> が <tt class="docutils literal"><span class="pre">Restaurant</span></tt> クラスで <em>ない</em> のなら (<tt class="docutils literal"><span class="pre">Place</span></tt> から
直接生成されたオブジェクトや、他のクラスの親クラスなら)  <tt class="docutils literal"><span class="pre">p.restaurant</span></tt>
はエラーを引き起こします。</p>
<div class="section" id="s-id33">
<span id="s-meta-and-multi-table-inheritance"></span><h4><tt class="docutils literal"><span class="pre">Meta</span></tt> とマルチテーブル継承<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p>マルチテーブル継承では、子クラスが親クラスの <a class="reference internal" href="#meta-options"><em>Meta</em></a> ク
ラスを継承する意味がありません。 <a class="reference internal" href="#meta-options"><em>Meta</em></a> オプションは全
て親クラスだけに適用されるべきもので、他のクラスに同じ内容を適用しても、矛
盾した振る舞いを引き起こすだけです(これは、独自のテーブルを持たない抽象ベー
スクラスと対照的な部分です)。</p>
<p>従って、マルチテーブル継承の子クラスは親クラスの <a class="reference internal" href="#meta-options"><em>Meta</em></a>
クラスにアクセスする方法を持ちません。ただし、限られたケースで、子クラスが
親クラスの挙動を継承する場合があります。それは、子クラスで
<a title="django.db.models.Options.ordering" class="reference external" href="../../ref/models/options.html#django.db.models.Options.ordering"><tt class="xref docutils literal"><span class="pre">django.db.models.Options.ordering</span></tt></a> または
<a title="django.db.models.Options.get_latest_by" class="reference external" href="../../ref/models/options.html#django.db.models.Options.get_latest_by"><tt class="xref docutils literal"><span class="pre">django.db.models.Options.get_latest_by</span></tt></a> 属性を指定していない場合に、
親クラスの属性を継承するというものです。</p>
<p>親クラスで整列カラムが指定されていて、子クラス側で整列カラムを指定したくな
い場合は、明示的に空の整列カラムを指定してください:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">ChildModel</span><span class="p">(</span><span class="n">ParentModel</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># 親クラスの整列カラム設定の効果を除去する</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<div class="section" id="s-id34">
<span id="s-inheritance-and-reverse-relations"></span><h4>継承と逆リレーション<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>マルチテーブル継承は親クラスと子クラスを暗黙の
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> でリンクするので、前述の例
のように、親クラスから子クラスをたどれます。しかし、子クラスをたどるときに
使う名前は、 <tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt> や
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> リレーションを定義したと
きのデフォルトの <a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> と同じ値
を使っています。従って、子クラスで
<tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt> や
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> を別のクラスに向けて張る
ときには、 <strong>必ず</strong> <a title="django.db.models.ForeignKey.related_name" class="reference external" href="../../ref/models/fields.html#django.db.models.ForeignKey.related_name"><tt class="xref docutils literal"><span class="pre">related_name</span></tt></a> をフィー
ルドに指定せねばなりません。指定し忘れると、 Django は
<tt class="xref docutils literal"><span class="pre">manage.py</span> <span class="pre">validate</span></tt> や <tt class="xref docutils literal"><span class="pre">syncdb</span></tt> 時にエラーを
送出します。</p>
<p>例えば、上の <tt class="docutils literal"><span class="pre">Place</span></tt> クラスに対して、
<tt class="xref docutils literal"><span class="pre">ManyToManyField</span></tt> を持った別のサブクラスを
定義するには、以下のように書きます:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Supplier</span><span class="p">(</span><span class="n">Place</span><span class="p">):</span>
    <span class="c"># Must specify related_name on all relations.</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Restaurant</span><span class="p">,</span>
            <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;provider&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="s-id35">
<span id="s-specifying-the-parent-link-field"></span><h4>親クラスのリンクフィールドを定義する<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>すでに触れたように、 Django は子クラスと抽象クラスでない親クラスにリンクし
た <tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を自動的に生成します。親
クラスへのリンク名を操作したければ、自分で
<tt class="xref docutils literal"><span class="pre">OneToOneField</span></tt> を作成し、パラメタに
<tt class="xref docutils literal"><span class="pre">parent_link=True</span></tt>
を渡してください。</p>
</div>
</div>
<div class="section" id="s-id36">
<span id="s-multiple-inheritance"></span><h3>多重継承<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>Python のサブクラスと同様、 Django のモデルも複数の親モデルクラスを継承でき
ます。クラス内の名前解決には、 Python の通常の名前解決規則が適用されるので
注意してください。子クラスで特定の名前 (例えば <a class="reference internal" href="#meta-options"><em>Meta</em></a>)
を参照する場合、その名前を定義している最初のベースクラスの定義を使い、最初
に名前が見つかった時点で、それ以降同じ名前のオブジェクトの解決は行われませ
ん。従って、複数の親クラスで別々に <a class="reference internal" href="#meta-options"><em>Meta</em></a> クラスを定義
していても、最初のベースクラスの <a class="reference internal" href="#meta-options"><em>Meta</em></a> だけが使われ、
それ以外は全て無視されます。</p>
<p>通常は、モデルの多重継承は必要ないでしょう。多重継承が便利なのは、主に特定
のフィールドやメソッドを追加するための ''mix-in'' クラスを使う場合です。
継承の階層構造はできるだけ単純に、分かりやすくしておきましょう。さもないと、
子クラスで扱っている情報が、どの親クラスから来たか調べるために四苦八苦する
はめになるでしょう。</p>
</div>
</div>
</div>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference external" href="">モデルの作成</a><ul>
<li><a class="reference external" href="#id3">簡単な例</a></li>
<li><a class="reference external" href="#id4">モデルを使う</a></li>
<li><a class="reference external" href="#id5">フィールド</a><ul>
<li><a class="reference external" href="#id6">フィールドのタイプ</a></li>
<li><a class="reference external" href="#id7">フィールドのオプション</a></li>
<li><a class="reference external" href="#id9">自動的な主キーフィールド</a></li>
<li><a class="reference external" href="#id10">詳細なフィールド名</a></li>
<li><a class="reference external" href="#id11">リレーション</a><ul>
<li><a class="reference external" href="#id12">多対一のリレーション</a></li>
<li><a class="reference external" href="#id14">多対多のリレーション</a></li>
<li><a class="reference external" href="#id16">多対多を定義するためのエクストラフィールド</a></li>
<li><a class="reference external" href="#id17">一対一のリレーション</a></li>
</ul>
</li>
<li><a class="reference external" href="#id19">ファイル間にまたがるモデル</a></li>
<li><a class="reference external" href="#id20">フィールド名の制約</a></li>
<li><a class="reference external" href="#id21">カスタムのフィールド型</a></li>
</ul>
</li>
<li><a class="reference external" href="#meta">Meta オプション</a></li>
<li><a class="reference external" href="#id24">モデルのメソッド</a><ul>
<li><a class="reference external" href="#id26">既存のモデルメソッドをオーバライドする</a></li>
<li><a class="reference external" href="#sql">カスタム SQL の実行</a></li>
</ul>
</li>
<li><a class="reference external" href="#id27">モデルの継承</a><ul>
<li><a class="reference external" href="#id29">抽象ベースクラス</a><ul>
<li><a class="reference external" href="#id30"><tt class="docutils literal"><span class="pre">Meta</span></tt> の継承</a></li>
<li><a class="reference external" href="#related-name"><tt class="docutils literal"><span class="pre">related_name</span></tt> に注意</a></li>
</ul>
</li>
<li><a class="reference external" href="#id32">マルチテーブル継承</a><ul>
<li><a class="reference external" href="#id33"><tt class="docutils literal"><span class="pre">Meta</span></tt> とマルチテーブル継承</a></li>
<li><a class="reference external" href="#id34">継承と逆リレーション</a></li>
<li><a class="reference external" href="#id35">親クラスのリンクフィールドを定義する</a></li>
</ul>
</li>
<li><a class="reference external" href="#id36">多重継承</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>前後のページ</h3>
  <ul>
    
      <li>前: <a href="index.html">モデルとデータベース</a></li>
    
    
      <li>次: <a href="queries.html">クエリを生成する</a></li>
    
  </ul>
  <h3>現在のページ:</h3>
  <ul>
      <li>
        <a href="../../index.html">Django v1.0 documentation</a>
        
          <ul><li><a href="../index.html">Django を使う</a>
        
          <ul><li><a href="index.html">モデルとデータベース</a>
        
        <ul><li>モデルの作成</li></ul>
        </li></ul></li></ul>
      </li>
  </ul>  

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/topics/db/models.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="../../search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">Aug 31, 2012</p>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="モデルとデータベース">前へ</a> 
     |
    <a href="../index.html" title="Django を使う" accesskey="U">上へ</a>
   |
    <a href="queries.html" title="クエリを生成する">次へ</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>