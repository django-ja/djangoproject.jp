<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>はじめての Django アプリ作成、その 1 &mdash; Django v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="contents" title="Global table of contents" href="../contents.html" />
    <link rel="index" title="Global index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Django v1.0 documentation" href="../index.html" />
    <link rel="up" title="さあ始めましょう" href="index.html" />
    <link rel="next" title="はじめての Django アプリ作成、その 2" href="tutorial02.html" />
    <link rel="prev" title="インストールガイド" href="install.html" />
  </head>
  <body>
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django v1.0 documentation</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">ホーム</a>  |
        <a title="Table of contents" href="../contents.html">目次</a>  |
        <a title="Global index" href="../genindex.html">索引</a>  |
        <a title="Search" href="../modindex.html">モジュール一覧</a>
      </div>
      <div class="nav">
    &laquo; <a href="install.html" title="インストールガイド">前へ</a> 
     |
    <a href="index.html" title="さあ始めましょう" accesskey="U">上へ</a>
   |
    <a href="tutorial02.html" title="はじめての Django アプリ作成、その 2">次へ</a> &raquo;</div>
    </div>
    
    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="intro-tutorial01">
            
  
  <div class="section" id="s-django-1">
<span id="s-intro-tutorial01"></span><h1><a class="toc-backref" href="#id7">はじめての Django アプリ作成、その 1<a class="headerlink" href="#django-1" title="Permalink to this headline">¶</a></a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#django-1" id="id7">はじめての Django アプリ作成、その 1</a><ul>
<li><a class="reference internal" href="#id1" id="id8">プロジェクトの作成</a><ul>
<li><a class="reference internal" href="#id3" id="id9">開発用サーバ</a></li>
<li><a class="reference internal" href="#database" id="id10">Database の設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4" id="id11">モデルの作成</a></li>
<li><a class="reference internal" href="#id5" id="id12">モデルを有効にする</a></li>
<li><a class="reference internal" href="#api" id="id13">API で遊んでみる</a></li>
</ul>
</li>
</ul>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">revision-up-to:</th><td class="field-body">8961 (1.0)</td>
</tr>
</tbody>
</table>
<p>さあ、例を交えながら学んでゆきましょう。</p>
<p>このチュートリアルでは、簡単な投票 (poll) アプリケーションの作成に取り組ん
でもらいます。</p>
<p>Poll アプリケーションは、</p>
<ul class="simple">
<li>ユーザが投票したり結果を表示したりできる公開用サイト</li>
<li>投票項目の追加、変更、削除を行うための管理 (admin) サイト</li>
</ul>
<p>の二つの部分に分かれているものとします。
<a class="reference external" href="install.html#intro-install"><em>Django は既にインストール済み</em></a> ですよね？ では始めま
しょう。 Django がインストールされているかどうかは、Python 対話シェルを起動
して <tt class="docutils literal"><span class="pre">import</span> <span class="pre">django</span></tt> を実行してみればわかります。エラーなく import できる
なら、 Django はインストールされています。</p>
<div class="admonition- admonition">
<p class="first admonition-title">困ったときは:</p>
<p class="last">このチュートリアルを進めてゆく上で困ったことがあったら、
<a class="reference external" href="http://groups.google.com/group/django-users">django-users</a> や
<tt class="docutils literal"><span class="pre">irc.freenode.net</span></tt> の
<a class="reference external" href="irc://irc.freenode.net/django">#djangoチャネル</a> で誰か助けてくれそ
うな人と話してみてください。</p>
</div>
<div class="section" id="s-id1">
<span id="s-creating-a-project"></span><h2><a class="toc-backref" href="#id8">プロジェクトの作成<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></a></h2>
<p>初めて Django を使うのなら、最初のセットアップを行う必要があります。通常は、
Django の <a class="reference external" href="../glossary.html#term-17"><em class="xref">プロジェクト</em></a> (<a class="reference external" href="../glossary.html#term-project"><em class="xref">project</em></a>) を構成するコードを自動生成
します。プロジェクトとは、データベースの設定や Django 固有のオプション、ア
プリケーション固有の設定などといった、個々の Django インスタンスの設定をあ
つめたものです。</p>
<p>コマンドラインから、コードを置きたい場所に <tt class="docutils literal"><span class="pre">cd</span></tt> して、
<tt class="docutils literal"><span class="pre">django-admin.py</span> <span class="pre">startproject</span> <span class="pre">mysite</span></tt> を実行してください。現在のディレク
トリに <tt class="docutils literal"><span class="pre">mysite</span></tt> ディレクトリが作成されます。</p>
<div class="admonition-max-os-x admonition">
<p class="first admonition-title">Max OS X でのパーミッションに関するエラー</p>
<p class="last">Mac OS X を使っている場合、 <tt class="docutils literal"><span class="pre">django-admin.py</span> <span class="pre">startproject</span></tt> を実行しよ
うとすると、 &#8220;permission denied&#8221; というメッセージが出ることがあります。
OS X のような Unix ベースのシステムでは、ファイルをプログラムとして実行
したい場合に、ファイルに「プログラムとして実行可能」というマークをつけて
おく必要があるためです。ファイルに実行可能マークをつけるには、
Terminal.app を起動して、 <a class="reference external" href="../ref/django-admin.html#ref-django-admin"><em>django-admin.py</em></a> を収
めているディレクトリに ( <tt class="docutils literal"><span class="pre">cd</span></tt> コマンドで) 移動して、
<tt class="docutils literal"><span class="pre">chmod</span> <span class="pre">+x</span> <span class="pre">django-admin.py</span></tt> を実行してください。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">プロジェクトの名前を付けるとき、組み込みの Python モジュールや Django
のコンポーネントの名前を使わないようにしてください。とりわけ、
<tt class="docutils literal"><span class="pre">django</span></tt> (Django 自体と被ってしまいます) や <tt class="docutils literal"><span class="pre">test</span></tt> (組み込みの
Python パッケージ名と被ります) を使わないようにしましょう。</p>
</div>
<p><tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></tt> ユーティリティで Django をインストールしたのなら、
<tt class="docutils literal"><span class="pre">django-admin.py</span></tt> はシステムパスのどこかにあるはずです。パス上になけ
れば、 <tt class="docutils literal"><span class="pre">site-packages/django/bin</span></tt> にあります。 <tt class="docutils literal"><span class="pre">site-packages</span></tt> は
Python インストールディレクトリの中にあります。パス上のどこか、例えば
<tt class="docutils literal"><span class="pre">/usr/local/bin</span></tt> にシンボリックリンクを張っておきましょう。)</p>
<div class="admonition- admonition">
<p class="first admonition-title">コードはどこに置くの？</p>
<p>PHP の経験があるなら、これまでは Web サーバのドキュメントルート下
(<tt class="docutils literal"><span class="pre">/var/www</span></tt> といった場所) にコードを配置してきたことでしょう。 Django
ではそうする必要はありません。むしろ Python コードをドキュメントルート
下に置くのは賢明ではありません。コードをドキュメントルート下に置くと、
誰かがコードを Web を介して読めるようになってしまうからです。これは安全
上よろしくありません。</p>
<p class="last">コードはドキュメントルートの <strong>外</strong> 、例えば <tt class="docutils literal"><span class="pre">/home/mycode</span></tt> の
ような場所に置きましょう。</p>
</div>
<p><tt class="xref docutils literal"><span class="pre">startproject</span></tt> が何を作成したかをみてみましょう:</p>
<pre>mysite/
    __init__.py
    manage.py
    settings.py
    urls.py</pre>
<p>ファイルはそれぞれ以下のような役割を持っています:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">__init__.py</span></tt>: このディレクトリが Python パッケージであることを
Python に知らせるための空のファイルです。(Python の初心者は、 Python
の公式ドキュメントの (<a class="reference external" href="http://www.python.jp/doc/release/tut/node8.html#packages">パッケージの詳しい説明</a> を読んで下さい。)</li>
<li><tt class="docutils literal"><span class="pre">manage.py</span></tt>: Django プロジェクトに対する様々な操作を行うための
コマンドラインユーティリティです。詳しくは <a class="reference external" href="../ref/django-admin.html#ref-django-admin"><em>django-admin.py と manage.py</em></a>
を参照してください。</li>
<li><tt class="docutils literal"><span class="pre">settings.py</span></tt>: Django プロジェクトの設定ファイルです。
設定の仕組みは <a class="reference external" href="../topics/settings.html#topics-settings"><em>Django の設定</em></a> を参照してください。</li>
<li><tt class="docutils literal"><span class="pre">urls.py</span></tt>: Django プロジェクトの URL 宣言、いうなれば Django 化サイ
トにおける「目次」に相当します。 <a class="reference external" href="../topics/http/urls.html#topics-http-urls"><em>URL ディスパッチャ</em></a> を参照してく
ださい。</li>
</ul>
<div class="section" id="s-id3">
<span id="s-the-development-server"></span><h3><a class="toc-backref" href="#id9">開発用サーバ<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></a></h3>
<p>プロジェクトがうまく動作するか確かめましょう。 <tt class="docutils literal"><span class="pre">mysite</span></tt> ディレクトリ
に移り、 <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></tt> を実行してください。以下のようなメッ
セージが表示されるはずです:</p>
<pre>Validating models...
0 errors found.

Django version 1.0, using settings 'mysite.settings'
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.</pre>
<p>これで、 Django 開発サーバを起動しました。 Django 開発サーバは Python だけ
で書かれた軽量な Web サーバです。このサーバは、開発を迅速に行い、運用に適し
た状態になるまで Apache のような運用サーバの設定をいじらなくても良いように
するためのものです。</p>
<p>ここで注意しておいたほうがよいでしょう: このサーバは開発中の利用だけを考え
て作られているため、絶対に運用環境では使わないようにしてください (筆者たち
の専門は Web フレームワークであって、 Web サーバではありません)。</p>
<p>さあ、これでサーバが起動したので、ブラウザで <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> にアク
セスしてみてください。 &quot;Welcome to Django&quot; と表示された、愉快げなパステル調
のライトブルーのページが出るはずです。やったね！</p>
<div class="admonition- admonition">
<p class="first admonition-title">ポート番号の変更</p>
<p>デフォルトでは、 <tt class="xref docutils literal"><span class="pre">runserver</span></tt> コマンドを実行すると、開発用サー
バはポート番号 8000 で起動します。サーバのポート番号を変更したければ、
コマンドライン引数で指定します。例えばポート番号を 8080 にしたければ以
下のようにしてください:</p>
<div class="highlight"><pre>python manage.py runserver 8080
</pre></div>
<p class="last">開発サーバの詳細な説明は <tt class="xref docutils literal"><span class="pre">runserver</span></tt> のリファレンスを参照して
ください。</p>
</div>
</div>
<div class="section" id="s-database">
<span id="s-database-setup"></span><h3><a class="toc-backref" href="#id10">Database の設定<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></a></h3>
<p>それでは、 <tt class="docutils literal"><span class="pre">settings.py</span></tt> を編集しましょう。 <tt class="docutils literal"><span class="pre">settings.py</span></tt> は
Django の設定を表現する通常の Python モジュールです。設定を書き換えて、お使
いのデータベースへの接続パラメタに合わせましょう:</p>
<ul class="simple">
<li><a class="reference external" href="../ref/settings.html#setting-DATABASE_ENGINE"><tt class="xref docutils literal"><span class="pre">DATABASE_ENGINE</span></tt></a> -- 'postgresql_psycopg2', 'mysql' または
'sqlite3'のいずれかです。他にも <a class="reference external" href="../ref/settings.html#setting-DATABASE_ENGINE"><tt class="xref docutils literal"><span class="pre">いくつか</span></tt></a>
あります。</li>
<li><tt class="xref docutils literal"><span class="pre">DATABASE_NAME`</span></tt> -- データベースの名前です。 SQLite を使っ
ている場合にはデータベースファイルのフルパス (絶対パス) にします。
指定したパスのファイルが存在しなければ、 Django は最初にデータベース
の同期を実行したときにファイルを生成します (後で解説します)。</li>
<li><a class="reference external" href="../ref/settings.html#setting-DATABASE_USER"><tt class="xref docutils literal"><span class="pre">DATABASE_USER</span></tt></a> -- データベースのユーザ名です (SQLite では
使いません)。</li>
<li><a class="reference external" href="../ref/settings.html#setting-DATABASE_PASSWORD"><tt class="xref docutils literal"><span class="pre">DATABASE_PASSWORD</span></tt></a> -- データベースのパスワードです。
(SQLite では使いません)。</li>
<li><a class="reference external" href="../ref/settings.html#setting-DATABASE_HOST"><tt class="xref docutils literal"><span class="pre">DATABASE_HOST</span></tt></a> -- データベースのあるホストです。データベー
スサーバが物理的に同じマシン上にあるのなら空文字列にしておきます。
(SQLite では使いません)。</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>PostgreSQL や MySQL を使っている場合、この時点でデータベースを作成して
おいてください。データベースを作成するには、データベースの対話プロンプ
トで &quot;<tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">DATABASE</span> <span class="pre">database_name;</span></tt>&quot; を実行します。</p>
<p class="last">SQLite を使う場合には、予め何か作成しておく必要はありません。データベー
スファイルは、必要に応じて自動的に生成されます。</p>
</div>
<p><tt class="docutils literal"><span class="pre">settings.py</span></tt> を編集する際、ファイルの末尾近くにある
<a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> 設定に注意してください。この変数には、現在の
Django インスタンスで有効な全ての Django アプリケーションの名前が入ります。
アプリケーションは複数のプロジェクトで利用でき、配布もできます。</p>
<p>デフォルトでは <a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> には以下のアプリケーションが入って
います。これらのアプリケーションはいずれも Django に付属のものです:</p>
<ul class="simple">
<li><a title="Django の認証フレームワークです。" class="reference external" href="../topics/auth.html"><tt class="xref docutils literal"><span class="pre">django.contrib.auth</span></tt></a> -- 認証システムです。</li>
<li><a title="インストール済のモデルを扱うための汎用インタフェースを提供します。" class="reference external" href="../ref/contrib/contenttypes.html"><tt class="xref docutils literal"><span class="pre">django.contrib.contenttypes</span></tt></a> -- コンテンツタイプフレームワーク
です。</li>
<li><tt class="xref docutils literal"><span class="pre">django.contrib.sessions</span></tt> -- セッションフレームワークです。</li>
<li><a title="複数のウェブサイトを一つのデータベースと Django プロジェクト で操作できるようにします。" class="reference external" href="../ref/contrib/sites.html"><tt class="xref docutils literal"><span class="pre">django.contrib.sites</span></tt></a> -- 一つの Django で複数のサイトを管理する
ためのフレームワークです。</li>
</ul>
<p>これらは、よくある状況で便利なのでデフォルトで付属しています。</p>
<p>これらのアプリケーションは必ず少なくとも一つのデータベーステーブルを使いま
す。そこで、アプリケーションを使う前にテーブルを作成しておく必要があります。
テーブルを作成するには以下のコマンドを使います:</p>
<div class="highlight"><pre>python manage.py syncdb
</pre></div>
<p><tt class="xref docutils literal"><span class="pre">syncdb</span></tt> コマンドは <a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> 設定を探し、
<tt class="docutils literal"><span class="pre">settings.py</span></tt> のデータベース設定に従ってデータベース上に必要なテーブ
ルを作成します。コマンドが生成したデータベースを示すメッセージが表示され、
認証システムで使うスーパユーザアカウントを作成したいかどうか尋ねるプロンプ
トが出ます。アカウントを作成しておきましょう。</p>
<p>Django がどんなテーブルを作成したか興味があるなら、データベースのコマンドラ
インクライアントを使って、 <tt class="docutils literal"><span class="pre">\dt</span></tt> (PostgreSQL), <tt class="docutils literal"><span class="pre">SHOW</span> <span class="pre">TABLES;</span></tt> (MySQL),
あるいは <tt class="docutils literal"><span class="pre">.schema</span></tt> (SQLite) と入力してみましょう。</p>
<div class="admonition- admonition">
<p class="first admonition-title">ミニマリストのために</p>
<p class="last">上で述べたように、デフォルトのアプリケーションはよくあるケースに対応す
るために入っているにすぎず、誰もが必要としているわけではありません。デ
フォルトアプリケーションの一部なり全部なりが必要なければ、
<tt class="xref docutils literal"><span class="pre">syncdb</span></tt> を実行する前に該当する行をコメントアウトするか削除し
てかまいません。 <tt class="xref docutils literal"><span class="pre">syncdb</span></tt> コマンドは <a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a>
にあるアプリケーションのテーブルを生成しているにすぎません。</p>
</div>
</div>
</div>
<div class="section" id="s-id4">
<span id="s-creating-models"></span><h2><a class="toc-backref" href="#id11">モデルの作成<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></a></h2>
<p>さあ、これで自分用の環境、すなわちプロジェクトが立ち上がり、作業にとりかか
る準備ができました。</p>
<p>Django で書いたアプリケーションは Python パッケージからなり、 ある規約に従っ
て <a class="reference external" href="http://www.python.jp/doc/release/tut/node8.html#SECTION008110000000000000000">Python パス</a> のどこかに置かねばなりません。Django にはアプリケーション
の基本的なディレクトリ構造を作成するためのユーティリティがついてくるので、
ディレクトリの作成は気にせずコードの記述に集中できます。</p>
<div class="admonition- admonition">
<p class="first admonition-title">プロジェクトとアプリケーション</p>
<p class="last">プロジェクトとアプリケーションの違いとは何でしょうか？アプリケーション
とは、実際に何らかの処理を行う Web アプリケーションを指します。例えばブ
ログシステムや公開レコードのデータベース、単純な投票アプリといった具合
です。プロジェクトとは、あるウェブサイト向けに設定とアプリケーションを
集めたものです。一つのプロジェクトには複数のアプリケーションを入れられ
ます。また、一つのアプリケーションは複数のプロジェクトで使えます。</p>
</div>
<p>このチュートリアルでは、簡単のため、投票アプリケーションを <tt class="docutils literal"><span class="pre">mysite</span></tt>
ディレクトリの中に作ります。その結果、アプリケーションはプロジェクトとカッ
プリングします。すなわち、 poll アプリケーション内の Python コードは
<tt class="docutils literal"><span class="pre">mysite.polls</span></tt> のように参照されることになります。チュートリアルの後半では、
アプリケーションを配布用に脱カップリングする方法について議論する予定です。</p>
<p>アプリケーションを作成するには、 <tt class="docutils literal"><span class="pre">mysite</span></tt> ディレクトリの下に入って、
以下のようなコマンド:</p>
<div class="highlight"><pre>python manage.py startapp polls
</pre></div>
<p>を入力します。このコマンドは <tt class="docutils literal"><span class="pre">polls</span></tt> というディレクトリを作成し、その
中に以下のようにファイルを配置します:</p>
<pre>polls/
    __init__.py
    models.py
    views.py</pre>
<p>このディレクトリ構造こそが、 poll アプリケーションの全体像です。</p>
<p>Django でデータベース Web アプリケーションを書くための最初のステップは、モ
デルの定義です。本質的には、データベースのレイアウトと、追加のメタデータの
定義です。</p>
<div class="admonition-philosophy admonition">
<p class="first admonition-title">設計哲学</p>
<p class="last">モデルは、手持ちのデータに対する唯一 (single) の決定的な (definitive)
ソースです。モデルには自分が格納したいデータにとって必要不可欠なフィー
ルドと、そのデータの挙動を収めます。 Django は <a class="reference external" href="../misc/design-philosophies.html#dry"><em>DRY 則</em></a> に従っ
ています。Django のモデルの目的は、ただ一つの場所でデータモデルを定義し、
そこから自動的にデータを取り出せるようにすることにあります。</p>
</div>
<p>これから開発する簡単な poll アプリケーションでは、投票項目 (poll) と選択肢
(choice) の二つのモデルを作成します。 poll には質問事項 (question) と公開日
(publication date) の情報があります。 choice には選択肢のテキストと投票数
(vote) という二つのフィールドがあります。各 choice は一つの poll に関連づけ
られることになります。</p>
<p>Django では、こうした概念を簡単な Python クラスで表現できます。
<tt class="docutils literal"><span class="pre">polls/models.py</span></tt> ファイルを以下のように編集してください:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">&#39;date published&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Poll</span><span class="p">)</span>
    <span class="n">choice</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
</pre></div>
<div class="admonition-attr-django-db-models-field-max-length admonition">
<p class="first admonition-title"> <tt class="xref docutils literal"><span class="pre">max_length</span></tt> にまつわるエラー</p>
<p>Django が <tt class="xref docutils literal"><span class="pre">max_length</span></tt> が正しい引数でない
というエラーを出す場合、古いバージョンの Django を使っているはずです。
(チュートリアルのこのバージョンは、最新の開発版 Django に準拠しています)
Subversion を使って開発版の Django をチェックアウトしている場合 (詳しい
方法は <a class="reference external" href="../topics/install.html#topics-install"><em>インストール方法</em></a> を参照してください) 、エ
ラーは起きないはずです。</p>
<p class="last">古いバージョンの Django を使わねばならない場合、
<a class="reference external" href="http://www.djangoproject.com/documentation/0.96/tutorial01/">バージョン 0.96 用のチュートリアル</a> を参照するよう勧めます。というのも、
このチュートリアルのカバーしている機能には、開発版の Django にしかないも
のがあるからです。</p>
</div>
<p>コードは単純明解ですね。各モデルは一つのクラスで表現され、いずれも
<a title="django.db.models.Model" class="reference external" href="../ref/models/instances.html#django.db.models.Model"><tt class="xref docutils literal"><span class="pre">django.db.models.Model</span></tt></a> のサブクラスです。各モデルには複数のクラス
変数があり、個々のクラス変数はモデルのデータベースフィールドを表現していま
す。</p>
<p>各フィールドは <tt class="xref docutils literal"><span class="pre">Field</span></tt> クラスのインスタンスとして
表現されています。例えば、 <tt class="xref docutils literal"><span class="pre">CharField</span></tt> は
文字のフィールドで、 <a title="django.db.models.DateTimeField" class="reference external" href="../ref/models/fields.html#django.db.models.DateTimeField"><tt class="xref docutils literal"><span class="pre">DateTimeField</span></tt></a> は日時フィー
ルドです。こうしたクラスは、各フィールドにどのようなデータ型を記憶させるか
を Django に教えます。</p>
<p><tt class="xref docutils literal"><span class="pre">models.*Field`</span></tt> インスタンスの名前 (<tt class="docutils literal"><span class="pre">question</span></tt> や <tt class="docutils literal"><span class="pre">pub_date</span></tt>)
はフィールドの名前で、計算機にとって扱いやすい名前を付けます。この名前は
Python コードの中で使いますし、データベースではカラム名に使います。</p>
<p><tt class="xref docutils literal"><span class="pre">django.db.models.Field</span></tt> の第一固定引数には、オプションとして人間可
読なフィールド名も指定できます。このフィールド名は Django の二つの内省
(introspection) 機能で使う他、ドキュメントとしての役割も果たします。人間可
読なフィールド名を指定しない場合、 Django は機械可読な名前を使います。上の
例では、 <tt class="docutils literal"><span class="pre">Poll.pub_date</span></tt> にだけ人間可読なフィールド名を指定しました。モデ
ルの他のフィールドでは、フィールドの機械可読な名前は人間可読な名前としても
十分なので定義していません。</p>
<p><tt class="xref docutils literal"><span class="pre">Field</span></tt> クラスの中には必須の引数を持つものがありま
す。例えば <a title="django.db.models.CharField" class="reference external" href="../ref/models/fields.html#django.db.models.CharField"><tt class="xref docutils literal"><span class="pre">CharField</span></tt></a> には
<tt class="xref docutils literal"><span class="pre">max_length</span></tt> を指定する必要があります。この引
数はデータベーススキーマで使われる他、後で述べるバリデーションでも使われま
す。</p>
<p>最後に、 <a title="django.db.models.ForeignKey" class="reference external" href="../ref/models/fields.html#django.db.models.ForeignKey"><tt class="xref docutils literal"><span class="pre">ForeignKey</span></tt></a> を使ってリレーションが定義さ
れていることに注意して下さい。このリレーションは、各 Choice が一つの Poll
に関連づけられていることを Django に教えます。 Django は多対一、多対多、一
対一といった、広く使われているリレーション全てをサポートしています。</p>
</div>
<div class="section" id="s-id5">
<span id="s-activating-models"></span><h2><a class="toc-backref" href="#id12">モデルを有効にする<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></a></h2>
<p>前述のようなほんのわずかなコードをモデルに書くだけで、 Django はたくさんの
情報を手にします。このコードを使って、 Django は:</p>
<ul class="simple">
<li>アプリケーションのデータベーススキーマを作成 (<tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> 文を実
行) できます。</li>
<li>Poll や Choice オブジェクトに Python からアクセスするためのデータベー
ス API を作成できます。</li>
</ul>
<p>ただし、その前に <tt class="docutils literal"><span class="pre">polls</span></tt> アプリケーションをインストールしたことをプロジェ
クトに教えてやる必要があります。</p>
<div class="admonition-philosophy admonition">
<p class="first admonition-title">設計哲学</p>
<p class="last">Django アプリケーションは「プラグ可能 (pluggable)」です。アプリケーショ
ンは特定の Django インストールに結び付いていないので、アプリケーション
を複数のプロジェクトで使ったり、単体で配布したりできます。</p>
</div>
<p>再度 <tt class="docutils literal"><span class="pre">settings.py</span></tt> ファイルを編集して、 <a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> 設
定を変更し、 <tt class="docutils literal"><span class="pre">'mysite.polls'</span></tt> を入れます。以下のようになるはずです:</p>
<div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;mysite.polls&#39;</span>
<span class="p">)</span>
</pre></div>
<p>これで Django は <tt class="docutils literal"><span class="pre">mysite</span></tt> に <tt class="docutils literal"><span class="pre">polls</span></tt> アプリケーションが入っているこ
とを知りました。もう一つコマンドを実行してみましょう:</p>
<div class="highlight"><pre>python manage.py sql polls
</pre></div>
<p>以下のような (polls アプリケーション用の CRATE TABLE SQL 文) が表示されるは
ずです:</p>
<div class="highlight"><pre><span class="k">BEGIN</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_poll&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;question&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;pub_date&quot;</span> <span class="k">timestamp</span> <span class="k">with</span> <span class="n">time</span> <span class="k">zone</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">&quot;polls_choice&quot;</span> <span class="p">(</span>
    <span class="ss">&quot;id&quot;</span> <span class="nb">serial</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="ss">&quot;poll_id&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">REFERENCES</span> <span class="ss">&quot;polls_poll&quot;</span> <span class="p">(</span><span class="ss">&quot;id&quot;</span><span class="p">),</span>
    <span class="ss">&quot;choice&quot;</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="ss">&quot;votes&quot;</span> <span class="nb">integer</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
<span class="k">COMMIT</span><span class="p">;</span>
</pre></div>
<p>以下の点に注意してください:</p>
<ul class="simple">
<li>実際に出力される SQL 文は、使っているデータベースによって変わります。</li>
<li>テーブル名はアプリケーションの名前 (<tt class="docutils literal"><span class="pre">polls</span></tt>) とモデルの小文字表記
(<tt class="docutils literal"><span class="pre">poll</span></tt> および <tt class="docutils literal"><span class="pre">choice</span></tt>) を使って自動的に生成されます (この挙動は
オーバライドできます。)</li>
<li>主キー (primary key, ID) は自動的に生成されます (この挙動もオーバライ
ド可能です)</li>
<li>便宜上、 Django は外部キーのフィールド名に <tt class="docutils literal"><span class="pre">&quot;_id&quot;</span></tt> を追加します。も
ちろんこの挙動もオーバライド可能です。</li>
<li>外部キーのリレーションは <tt class="docutils literal"><span class="pre">REFERENCES</span></tt> 文で明示的に作成されます。</li>
<li>SQL 文は使っているデータベースに応じて細かく調整されます。従って、
<tt class="docutils literal"><span class="pre">auto_increment</span></tt> (MySQL)、 <tt class="docutils literal"><span class="pre">serial</span></tt> (PostgreSQL)、
<tt class="docutils literal"><span class="pre">integer</span> <span class="pre">primary</span> <span class="pre">key</span></tt> (SQLite) といったデータベース固有のフィールド
タイプは自動的に指定されます。クオートの仕方、すなわち一重と二重のど
ちらの引用符を使うか、といったことも自動で調整します。このチュートリ
アルの作者は PostgreSQL を使っており、例題での出力は PostgreSQL の文
法に準じています。</li>
<li><tt class="xref docutils literal"><span class="pre">sql</span></tt> コマンドを実行しても、実際にデータベースで SQL を実行
するわけではありません。 <tt class="docutils literal"><span class="pre">sql</span></tt> コマンドは、ユーザが Django の挙動を
知りたいと考えたときのため、単に SQL 文をスクリーンに表示しているだけ
です。必要なら、この SQL 文をコピーしてデータベースクライアントのプロ
ンプトにペーストできますが、後ですぐ述べるように、 Django では SQL を
データベースに commit させる簡単な方法を提供しています。</li>
</ul>
<p>興味があるなら、以下のコマンドも実行してみてください:</p>
<ul class="simple">
<li><tt class="xref docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">validate</span></tt> -- モデルの構成にエ
ラーがないか調べます。</li>
<li><tt class="xref docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">sqlcustom</span> <span class="pre">polls</span></tt> -- 各アプリケー
ション向けに定義しておいた、カスタマイズ (テーブル形式の変更や制約)
用の SQL 文を出力します。</li>
<li><tt class="xref docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">sqlclear</span> <span class="pre">polls</span></tt> -- アプリケーショ
ン用のテーブルのうち、データベース上に存在するものについて必要に応じ
て <tt class="docutils literal"><span class="pre">DROP</span> <span class="pre">TABLE</span></tt> 文を出力します。</li>
<li><tt class="xref docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">sqlindexes</span> <span class="pre">polls</span></tt> -- アプリケー
ション用の <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">INDEX</span></tt> 文を出力します。</li>
<li><tt class="xref docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">sqlall</span> <span class="pre">polls</span></tt> -- 'sql',
'sqlcustom', 'sqlindexes' コマンドを合わせたものです。</li>
</ul>
<p>これらのコマンドの出力を見れば、水面下で実際に行われていることを理解する助
けになるでしょう。</p>
<p><tt class="xref docutils literal"><span class="pre">syncdb</span></tt> を再度実行して、モデルテーブルをデータベース上に作成しま
しょう:</p>
<div class="highlight"><pre>python manage.py syncdb
</pre></div>
<p><tt class="xref docutils literal"><span class="pre">syncdb</span></tt> コマンドは <a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> に登録されているアプ
リケーションのうち、データベース上にまだ存在しないものに対して
<tt class="xref docutils literal"><span class="pre">sqlall</span></tt> で生成した SQL を生成します。こにれよって、最後に
<tt class="xref docutils literal"><span class="pre">syncdb</span></tt> を実行した時以後に新たにプロジェクトに追加されたアプリケー
ションのテーブルと初期データ、インデクスを生成します。  <tt class="xref docutils literal"><span class="pre">syncdb</span></tt>
はその都度存在しないテーブルだけを生成するので、繰り返し実行してもかまいま
せん。</p>
<p><tt class="docutils literal"><span class="pre">manage.py</span></tt> ユーティリティでできることについては
<a class="reference external" href="../ref/django-admin.html#ref-django-admin"><em>django-admin.py のドキュメント</em></a> を読んで下さい。</p>
</div>
<div class="section" id="s-api">
<span id="s-playing-with-the-api"></span><h2><a class="toc-backref" href="#id13">API で遊んでみる<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></a></h2>
<p>さて、Python 対話シェルを起動して、 Django が提供する API で遊んでみましょ
う。 Python シェルを起動するには、以下のコマンドを実行します:</p>
<div class="highlight"><pre>python manage.py shell
</pre></div>
<p>単に &quot;python&quot; を実行しないのは、 <tt class="docutils literal"><span class="pre">manage.py</span></tt> でプロジェクトの環境を設定し
ているからです。ここでいう「環境の設定」とは:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">mysite</span></tt> を <tt class="docutils literal"><span class="pre">sys.path</span></tt> に入れます。柔軟性を持たせるために、
Django を構成するコードの中には Python のドット表記 (例えば
<tt class="docutils literal"><span class="pre">'mysite.polls.models'</span></tt>) でプロジェクトを参照するものがあります。
この表記でプロジェクトをうまく参照できるようにするには、 <tt class="docutils literal"><span class="pre">mysite</span></tt>
パッケージは  <tt class="docutils literal"><span class="pre">sys.path</span></tt> 上になければなりません。</p>
<p>こうした表記法の例は、すでに見たことがあるはずです: 例えば
<a class="reference external" href="../ref/settings.html#setting-INSTALLED_APPS"><tt class="xref docutils literal"><span class="pre">INSTALLED_APPS</span></tt></a> 設定は、ドット表記のパッケージ名からなるリ
ストです。</p>
</li>
<li><p class="first">環境変数 <tt class="docutils literal"><span class="pre">DJANGO_SETTINGS_MODULE</span></tt> を設定して、 <tt class="docutils literal"><span class="pre">settings.py</span></tt> ファ
イルの在処を Django に教えます。</p>
</li>
</ul>
<div class="admonition-manage-py admonition">
<p class="first admonition-title">manage.py を使わずに済ませる方法</p>
<p><tt class="docutils literal"><span class="pre">manage.py</span></tt> を使いたくなくても、問題はありません。 <tt class="docutils literal"><span class="pre">mysite</span></tt> が
Python パス上にあるように (<tt class="docutils literal"><span class="pre">import</span> <span class="pre">mysite</span></tt> が通るように) して、環境変
数 <tt class="docutils literal"><span class="pre">DJANGO_SETTINGS_MODULE</span></tt> を  <tt class="docutils literal"><span class="pre">mysite.settings</span></tt> に設定してくださ
い。</p>
<p class="last">詳しくは <a class="reference external" href="../ref/django-admin.html#ref-django-admin"><em>django-admin.py のドキュメント</em></a> を参
照してください。</p>
</div>
<p>シェルに入ったら、 <a class="reference external" href="../topics/db/queries.html#topics-db-queries"><em>データベース API</em></a> の世界を探検
してみましょう:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mysite.polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span> <span class="c"># モデルクラスを import します。</span>

<span class="go"># まだ Poll は一つもできていません。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[]</span>

<span class="go"># 新たな Poll を作成しましょう。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;What&#39;s up?&quot;</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="go"># 出来たオブジェクトをデータベースに保存します。 save() は明示的に呼ば</span>
<span class="go"># ねばなりません。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># これでオブジェクトに ID が割り当てられました。お使いのデータベースに</span>
<span class="go"># よっては、この値は &quot;1&quot; ではなく &quot;1L&quot; のときもあります。心配することは</span>
<span class="go"># ありません。単にデータベースバックエンドが Python 長整数型で値を返す</span>
<span class="go"># ようになっているだけのことです。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>

<span class="go"># データベースの各カラムに Python の属性としてアクセスします。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">question</span>
<span class="go">&quot;What&#39;s up?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">pub_date</span>
<span class="go">datetime.datetime(2007, 7, 15, 12, 00, 53)</span>

<span class="go"># 属性を変更して save() を呼び出すとカラムの値を変更します。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="go"># objects.all() はデータベース上の全ての Poll を返します。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Poll: Poll object&gt;]</span>
</pre></div>
<p>おっと、ちょっと待って下さい。 <tt class="docutils literal"><span class="pre">&lt;Poll:</span> <span class="pre">Poll</span> <span class="pre">object&gt;</span></tt> なんて全然親切な表現
ではありませんね。そこで (<tt class="docutils literal"><span class="pre">polls/models.py</span></tt> ファイルに定義されている)
polls 関係のモデルを少し修正して、 <tt class="docutils literal"><span class="pre">Poll</span></tt> と <tt class="docutils literal"><span class="pre">Choice</span></tt> に
<a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> メソッドを追加しましょう:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span>

<span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice</span>
</pre></div>
<div class="admonition-meth-django-db-models-model-unicode admonition">
<p class="first admonition-title"><a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> がうまく動かない場合には</p>
<p>モデルに <a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> メソッドを追加した
のに、オブジェクトの表示が何も変化しないのなら、古いバージョンの Django
を使っているはずです。(チュートリアルのこのバージョンは、最新の開発版
Django に準拠しています) Subversion を使って開発版の Django をチェックア
ウトしている場合 (詳しい方法は <a class="reference external" href="../topics/install.html#topics-install"><em>インストール方法</em></a>
を参照してください) 、うまく動作するはずです。</p>
<p class="last">古いバージョンの Django を使わねばならない場合、
<a class="reference external" href="http://www.djangoproject.com/documentation/0.96/tutorial01/">バージョン 0.96 用のチュートリアル</a> を参照するよう勧めます。というのも、
このチュートリアルでは、開発版の Django にしかない機能をカバーしているか
らです。</p>
</div>
<p><a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> をモデルに追加しておく重要性は、
対話プロンプトで扱うときに精神的によいだけでなく、Django が自動生成する管理
インタフェースのいたるところでオブジェクトの表現 (representation) が使われ
ているという点にもあります。</p>
<div class="admonition-meth-django-db-models-model-str-meth-django-db-models-model-unicode admonition">
<p class="first admonition-title">なぜ <a title="django.db.models.Model.__str__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__str__"><tt class="xref docutils literal"><span class="pre">__str__()</span></tt></a> ではなく <a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> を使うの？</p>
<p>Python に詳しければ、普段は <a title="django.db.models.Model.__str__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__str__"><tt class="xref docutils literal"><span class="pre">__str__()</span></tt></a> で
はなく <a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> を実装していることで
しょう。 <a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> を使うのは、Django
のモデルがデフォルトで Unicode を扱うからです。 Django では、データベー
ス上に保存された文字列の情報は、取り出すときに全て Unicode 型に変換され
ます。</p>
<p class="last">Django のモデルは、デフォルトで
<a title="django.db.models.Model.__str__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__str__"><tt class="xref docutils literal"><span class="pre">__str__()</span></tt></a> メソッドを実装していて、中で
<a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> を呼び出して、得た結果を
UTF-8 のバイト文字列に変換しています。従って、 <tt class="docutils literal"><span class="pre">unicode(p)</span></tt> は
Unicode 文字列を返し、 <tt class="docutils literal"><span class="pre">str(p)</span></tt> は UTF-8 でエンコードされた通常の文字
列を返します。この仕様がよくわからなければ、とにかく
<a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> をモデルに追加するのだと覚
えておいてください。なにはともあれ、それでうまく動作します。</p>
</div>
<p><a title="django.db.models.Model.__unicode__" class="reference external" href="../ref/models/instances.html#django.db.models.Model.__unicode__"><tt class="xref docutils literal"><span class="pre">__unicode__()</span></tt></a> は通常の Python メソッドという
ことに注意してください。デモ用にカスタムのメソッドを追加してみましょう:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">datetime</span>
<span class="c"># ...</span>
<span class="k">class</span> <span class="nc">Poll</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">was_published_today</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</pre></div>
<p><tt class="docutils literal"><span class="pre">import</span> <span class="pre">datetime</span></tt> で Python の標準モジュール <tt class="docutils literal"><span class="pre">datetime</span></tt> を参照している
ことに注意してください。</p>
<p><tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">shell</span></tt> を実行して、Python 対話シェルに戻りましょう:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mysite.polls.models</span> <span class="kn">import</span> <span class="n">Poll</span><span class="p">,</span> <span class="n">Choice</span>

<span class="go"># __unicode__() がきちんと働いていることを確認します。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>

<span class="go"># Django は様々なデータベース照合 API を提供しています。 API はキーワー</span>
<span class="go"># ド引数で隅々まで操作できます。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s">&#39;What&#39;</span><span class="p">)</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>

<span class="go"># 2007 年の Poll を取り出しましょう。あなたがこのチュートリアルを実行</span>
<span class="go"># しているのが 2007 年でないのなら、適当に値を読みかえてください。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2007</span><span class="p">)</span>
<span class="go">&lt;Poll: What&#39;s up?&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">DoesNotExist</span>: <span class="n">Poll matching query does not exist.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s">&#39;What&#39;</span><span class="p">)</span>
<span class="go">[&lt;Poll: What&#39;s up?&gt;]</span>

<span class="go"># 主キーの照合はよくあることなので、 Django は主キーの厳密一致を照合</span>
<span class="go"># するショートカットを提供しています。</span>
<span class="go"># 以下の実行文は Poll.objects.get(id=1) と同じです。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">&lt;Poll: What&#39;s up?&gt;</span>

<span class="go"># カスタムメソッドが動作するか確かめてみましょう。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">was_published_today</span><span class="p">()</span>
<span class="go">False</span>

<span class="go"># Poll に二つの Choice を指定しましょう。 create を呼び出すと、新たな</span>
<span class="go"># Choice オブジェクトを生成し、 INSERT 文を実行し、 Poll からアクセス可</span>
<span class="go"># 能な Choice オブジェクトの集合に追加して、新たに作成された Choice オ</span>
<span class="go"># ブジェクトを返します。</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;Not much&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: Not much&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;The sky&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&lt;Choice: The sky&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice</span><span class="o">=</span><span class="s">&#39;Just hacking again&#39;</span><span class="p">,</span> <span class="n">votes</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="go"># Choice オブジェクトは自分に関連づけされた Poll オブジェクトに</span>
<span class="go"># アクセスするための API を備えています。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">poll</span>
<span class="go">&lt;Poll: What&#39;s up?&gt;</span>

<span class="go"># 逆も行えます: Poll オブジェクトから Choice オブジェクトにアクセスでき</span>
<span class="go"># ます。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">[&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3</span>

<span class="go"># API は必要に応じて自動的にリレーションを追跡します。リレーションを辿</span>
<span class="go"># るには二重アンダースコアを使います。この表記法には制限がなく、何段階</span>
<span class="go"># でも連鎖できます。以下の例では、 pub_date が 2007 の全ての Poll に関</span>
<span class="go"># 連づけられている Choice を返します。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Choice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">poll__pub_date__year</span><span class="o">=</span><span class="mi">2007</span><span class="p">)</span>
<span class="go">[&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]</span>

<span class="go"># choice を一つ削除しましょう。 delete() を使います。</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">choice__startswith</span><span class="o">=</span><span class="s">&#39;Just hacking&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
<p>データベース API の詳細は、
<a class="reference external" href="../topics/db/queries.html#topics-db-queries"><em>データベース API リファレンス</em></a> を参照してください。
API を使いこなせるようになったら、
<a class="reference external" href="tutorial02.html#intro-tutorial02"><em>チュートリアル第 2 部</em></a> に進んで、Django が自動生成
する管理インタフェースを動かしてみましょう。</p>
</div>
</div>


          </div>         
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Table Of Contents</h3>
            <ul>
<li><a class="reference external" href="">はじめての Django アプリ作成、その 1</a><ul>
<li><a class="reference external" href="#id1">プロジェクトの作成</a><ul>
<li><a class="reference external" href="#id3">開発用サーバ</a></li>
<li><a class="reference external" href="#database">Database の設定</a></li>
</ul>
</li>
<li><a class="reference external" href="#id4">モデルの作成</a></li>
<li><a class="reference external" href="#id5">モデルを有効にする</a></li>
<li><a class="reference external" href="#api">API で遊んでみる</a></li>
</ul>
</li>
</ul>

  <h3>前後のページ</h3>
  <ul>
    
      <li>前: <a href="install.html">インストールガイド</a></li>
    
    
      <li>次: <a href="tutorial02.html">はじめての Django アプリ作成、その 2</a></li>
    
  </ul>
  <h3>現在のページ:</h3>
  <ul>
      <li>
        <a href="../index.html">Django v1.0 documentation</a>
        
          <ul><li><a href="index.html">さあ始めましょう</a>
        
        <ul><li>はじめての Django アプリ作成、その 1</li></ul>
        </li></ul>
      </li>
  </ul>  

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/intro/tutorial01.txt">Show Source</a></li>
            </ul>
            <h3>Quick search</h3>
            <form class="search" action="../search.html" method="get">
              <input type="text" name="q" size="18" /> <input type="submit" value="Go" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">Aug 31, 2012</p>
          </div> 
        
      
    </div>
    
    <div id="ft">
      <div class="nav">
    &laquo; <a href="install.html" title="インストールガイド">前へ</a> 
     |
    <a href="index.html" title="さあ始めましょう" accesskey="U">上へ</a>
   |
    <a href="tutorial02.html" title="はじめての Django アプリ作成、その 2">次へ</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>